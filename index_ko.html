<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´ë¬¼ë„ê°</title>
    <link rel="apple-touch-icon" type="image/webp" href="img/apple-touch-icon-180x180.webp">
    <link rel="icon" type="image/webp" href="img/icon-192x192.webp">
    <style>
        /*
        =================================
        åŸºæœ¬è¨­å®šã¨ãƒªã‚»ãƒƒãƒˆ
        =================================
        */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none; /* ç”»åƒä¿å­˜ç¦æ­¢ */
            /* -webkit-user-select: none; */ /* ã‚³ãƒ”ãƒ¼ç¦æ­¢ */
        }

        body {
            font-family: 'Arial', sans-serif;
            background-image: url('img/background.webp');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /*
        =================================
        ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ
        =================================
        */
        .book-frame {
            width: 100%;
            max-width: 800px;
            aspect-ratio: 4/3;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .inventory-container {
            background: #E8F5E8;
            border-radius: 20px;
            padding: 20px;
            width: 100%;
            height: 90vh;
            max-height: 90vh;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /*
        =================================
        ã‚¹ãƒãƒ›å¯¾å¿œãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–
        =================================
        */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                align-items: flex-start;
                padding-top: 20px;
            }

            .book-frame {
                width: 100%;
                aspect-ratio: unset;
                height: calc(100vh - 140px);
            }

            .inventory-container {
                height: 100%;
                max-height: 100%;
                padding: 15px;
                border-radius: 15px;
            }

            .header-toggle-btn {
                width: 30px;
                height: 30px;
                font-size: 14px;
                top: 8px;
                right: 8px;
            }

            .title {
                font-size: 20px;
            }

            .tab-buttons {
                gap: 5px;
            }

            .tab-btn {
                padding: 8px 12px;
                font-size: 14px;
            }

            .item-count {
                font-size: 12px;
            }

            /* ã‚¹ãƒãƒ›ç¸¦å‘ã: 7åˆ—è¡¨ç¤º */
            .inventory-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 8px;
                padding: 10px;
            }
        }

        /* ã‚¹ãƒãƒ›æ¨ªå‘ãå¯¾å¿œ */
        @media (max-width: 1768px) and (orientation: landscape) {
            body {
                align-items: center;
                padding: 10px 100px;
            }

            .book-frame {
                height: calc(100vh - 20px);
            }

            .inventory-container {
                padding: 10px;
            }

            .header {
                padding-bottom: 8px;
            }

            .title {
                font-size: 18px;
            }

            .tab-btn {
                padding: 6px 10px;
                font-size: 13px;
            }

            .item-count {
                font-size: 11px;
            }

            /* ã‚¹ãƒãƒ›æ¨ªå‘ã: 7åˆ—è¡¨ç¤ºï¼ˆå°‘ã—å°ã•ãï¼‰ */
            .inventory-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 6px;
                padding: 8px;
            }

    		.popup-overlay {
        		padding: 10px 20px;  /* å·¦å³ã®ä½™ç™½ã‚’å‰Šæ¸› */
    		}

    		.popup {
        		padding: 15px;
        		max-width: 350px;          /* å¹…ã‚’åˆ¶é™ã—ã¦ç¸¦é•·ã« */
        		width: 350px;              /* å›ºå®šå¹…ã§ç¸¦é•·åŠ¹æœ */
        		max-height: calc(100vh - 20px);  /* ç¸¦å¹…ã‚’ç”»é¢ã„ã£ã±ã„ã« */
        		height: auto;              /* é«˜ã•ã¯è‡ªå‹•èª¿æ•´ */
        		min-height: calc(100vh - 40px);  /* æœ€å°é«˜ã•ã‚’è¨­å®šã—ã¦ç¸¦é•·ã« */
    		}
        }

        /*
        =================================
        ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†
        =================================
        */
        .header {
            display: flex;
            flex-direction: column;
            border-bottom: 2px solid #e0e0e0;
            flex-shrink: 0;
            position: relative;
        }

        .header-toggle-btn {
            position: absolute;
            top: 5px;
            right: -10px;
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            transition: all 0.3s ease;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-toggle-btn:hover {
            background: #e0e0e0;
            color: #333;
        }

        .header-content {
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .header-content.collapsed {
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            opacity: 0;
        }

        .title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center; /* ãƒœã‚¿ãƒ³ã‚’ä¸­å¤®æƒãˆã«ã™ã‚‹ */
        }

        /*
        =================================
        ã‚¿ãƒ–ãƒœã‚¿ãƒ³
        =================================
        */
        .tab-buttons {
            display: flex;
            gap: 10px;
            padding-bottom: 10px;
            justify-content: center; /* ãƒœã‚¿ãƒ³ã‚’ä¸­å¤®æƒãˆã«ã™ã‚‹ */
        }

        .tab-btn {
            padding: 10px 10px;
            /* border: none; */
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 18px; /* æš«å®šå¯¾å¿œ */
        }

        .tab-btn.active {
            background: linear-gradient(45deg, #4fc3f7, #29b6f6);
            color: white;
        }

        .tab-btn:not(.active) {
            background: #f0f0f0;
            color: #666;
        }

        .tab-btn:hover:not(.active) {
            background: #e0e0e0;
        }

        /*
        =================================
        ç¥ç¦å®ç‰©ã®å›è»¢ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        =================================
        */
        .blessing-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 3;
            animation: blessing-rotate 3s linear infinite;
            pointer-events: none;
        }

        @keyframes blessing-rotate {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å†…ã®ç¥ç¦ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
        .popup-blessing-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 3;
            animation: blessing-rotate 3s linear infinite;
            pointer-events: none;
        }

        /* ç¥ç¦å®ç‰©ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .popup.blessed {
            background: linear-gradient(135deg, #e8f5e8, #4fc3f7);
            border: 3px solid #29b6f6;
        }

        /*
        =================================
        ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        =================================
        */
        .effect-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 6;
            pointer-events: none;
            animation: effect-loop 3s infinite;
        }

        @keyframes effect-loop {
            0% {
                background-image: url('img/treasure_frame_effect01.webp');
            }

            3.33% {
                background-image: url('img/treasure_frame_effect02.webp');
            }

            6.66% {
                background-image: url('img/treasure_frame_effect03.webp');
            }

            9.99% {
                background-image: url('img/treasure_frame_effect04.webp');
            }

            13.32% {
                background-image: url('img/treasure_frame_effect06.webp');
            }

            16.65% {
                background-image: none;
            }

            100% {
                background-image: none;
            }
        }

        /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å†…ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .popup-effect-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 6;
            pointer-events: none;
            animation: effect-loop 3s infinite;
        }

        /*
        =================================
        è¡¨ç¤ºæ•°ã‚«ã‚¦ãƒ³ãƒˆ
        =================================
        */
        .item-count-display {
            display: block;
            margin-left: auto;
            margin-right: 12px;
            margin-top: 6px;
            font-size: 18px;
            font-weight: bold;
            color: #333;
            position: relative;
            z-index: 5;
        }

        @media (max-width: 768px) {
            .item-count-display {
                margin-right: 12px;
                margin-top: 6px;
                font-size: 12px;
            }
        }

        /*
        =================================
        ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‚°ãƒªãƒƒãƒ‰
        =================================
        */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, calc((100% - 36px) / 7));
            gap: 6px;
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 8px;
            background: #FFF8DC;
            border-radius: 15px;
            position: relative;
            margin-top: 10px;
            min-height: 0;
            justify-content: start;
            align-content: start;
        }

        .inventory-grid::-webkit-scrollbar {
            width: 8px;
        }

        .inventory-grid::-webkit-scrollbar-track {
            background: #e0e0e0;
            border-radius: 4px;
        }

        .inventory-grid::-webkit-scrollbar-thumb {
            background: #29b6f6;
            border-radius: 4px;
        }

        /*
        =================================
        ã‚¢ã‚¤ãƒ†ãƒ ã‚¹ãƒ­ãƒƒãƒˆ
        =================================
        */
        .item-slot {
            aspect-ratio: 1;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 15px;
        }

        .item-slot:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .item-frame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 1;
            pointer-events: none;
        }

        .item-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 2;
        }

        /*
        =================================
        ãƒ‘ãƒƒã‚·ãƒ–ã‚¿ã‚°ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        =================================
        */
        .passive-tag-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 5;
            pointer-events: none;
        }

        /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å†…ã®ãƒ‘ãƒƒã‚·ãƒ–ã‚¿ã‚°ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
        .popup-passive-tag-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 5;
            pointer-events: none;
        }

        /*
        =================================
        ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— - ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤
        =================================
        */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 20px;
        }

        .popup-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        /*
        =================================
        ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— - ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
        =================================
        */
        .popup {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            transform: scale(0.8);
            position: relative;
        }

        .popup-overlay.show .popup {
            transform: scale(1);
        }

        .popup-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        /*
        =================================
        ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— - ã‚¢ã‚¤ã‚³ãƒ³
        =================================
        */
        .popup-icon {
            width: 60px;
            height: 60px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
            flex-shrink: 0;
        }

        .popup-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 1;
        }

        .popup-icon .popup-item-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 2;
        }

        /*
        =================================
        ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— - ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚»ã‚¯ã‚·ãƒ§ãƒ³
        =================================
        */
        .popup-title {
            margin-right: 10px;
            font-size: 20px;
            font-weight: bold;
            line-height: 1.2;
            color: #333;
            white-space: pre-line;
            word-wrap: break-word;
        }

        .popup-section {
            margin-bottom: 15px;
            background: #f8f8f8;
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #e0e0e0;
        }

        .popup-section-title {
            background: #e8e8e8;
            margin: -15px -15px 10px -15px;
            padding: 10px 15px;
            border-radius: 10px 10px 0 0;
            border-bottom: 1px solid #d0d0d0;
            font-weight: bold;
            color: #666;
        }

        .popup-description {
            color: #555;
            line-height: 1.6;
            background: transparent;
            padding: 0;
            border-radius: 0;
        }

        /*
        =================================
        é€²åŒ–ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
        =================================
        */
        .evolution-preview {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding: 10px;
            background: #f0f8ff;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .evolution-preview:hover {
            background: #e3f2fd;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(41, 182, 246, 0.3);
        }

        .evolution-icon {
            width: 60px;
            height: 60px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
            border-radius: 8px;
            flex-shrink: 0;
        }

        .evolution-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 1;
        }

        .evolution-icon .evolution-item-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 2;
        }

        /*
        =================================
        é€²åŒ–å¾Œã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ«
        =================================
        */
        .popup.evolved {
            background: linear-gradient(135deg, #fff3e0, #ffcc02);
            border: 3px solid #ff9800;
        }

        /*
        =================================
        ä¸€èˆ¬å®ç‰©ã®ã‚¹ã‚¿ã‚¤ãƒ«
        =================================
        */
        .popup:not(.evolved) {
            border: 3px solid #ff9800;
        }

        /*
        =================================
        å…±æœ‰ãƒœã‚¿ãƒ³
        =================================
        */
        .share-btn {
            position: absolute;
            top: 5px;
            left: 15px;
            padding: 8px 15px;
            border: 2px solid #ff9800;
            border-radius: 20px;
            background: white;
            color: #ff9800;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            white-space: nowrap;
            z-index: 10;
        }

        .share-btn:hover {
            background: #ff9800;
            color: white;
        }

        .share-btn:active {
            background: #f57c00;
            transform: scale(0.95);
        }

        .share-btn.copied {
            background: #66bb6a;
            border-color: #66bb6a;
            color: white;
        }

        @media (max-width: 768px) {
            .share-btn {
                padding: 6px 12px;
                font-size: 12px;
                top: 3px;
                left: 10px;
            }
        }

        /*
        =================================
        éŸ“å›½èªåã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³
        =================================
        */
        .copy-korean-btn {
            position: absolute;
            top: 5px;
            right: 55px;
            padding: 8px 15px;
            border: 2px solid #4fc3f7;
            border-radius: 20px;
            background: white;
            color: #4fc3f7;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            white-space: nowrap;
            z-index: 10;
        }

        .copy-korean-btn:hover {
            background: #4fc3f7;
            color: white;
        }

        .copy-korean-btn:active {
            background: #29b6f6;
            transform: scale(0.95);
        }

        .copy-korean-btn.copied {
            background: #66bb6a;
            border-color: #66bb6a;
            color: white;
        }

        @media (max-width: 768px) {
            .copy-korean-btn {
                padding: 6px 12px;
                font-size: 12px;
                top: 3px;
                right: 35px;
            }
        }

        /*
        =================================
        é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³
        =================================
        */
        .close-btn {
            position: absolute;
            top: 0px;
            right: 0px;
            background: url('img/btn_x.webp') no-repeat center center;  /* ç”»åƒã‚’èƒŒæ™¯ã«è¨­å®š */
            background-size: contain;  /* ç”»åƒã‚’ãƒœã‚¿ãƒ³ã‚µã‚¤ã‚ºã«åˆã‚ã›ã‚‹ */
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
        }

        .close-btn:hover {
            background-image: url('img/btn_x.webp');  /* ãƒ›ãƒãƒ¼æ™‚ã‚‚åŒã˜ç”»åƒ */
            background-color: rgba(0, 0, 0, 0.3);   /* è–„æš—ã„ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
            background-blend-mode: darken;           /* ç”»åƒã‚’æš—ãã™ã‚‹ãƒ–ãƒ¬ãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰ */
        }

        /*
        =================================
        ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— - ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
        =================================
        */
        @media (max-width: 768px) {
            .popup {
                padding: 20px;
                margin: 10px;
                /* max-width: calc(100vw - 20px); */
                max-height: calc(100vh - 120px);
            }

            .popup-header {
                gap: 10px;
                margin-bottom: 15px;
            }

            .popup-icon {
                width: 50px;
                height: 50px;
            }

            .popup-title {
                font-size: 18px;
            }

            .evolution-icon {
                width: 50px;
                height: 50px;
            }

            .close-btn {
                width: 25px;
                height: 25px;
                background: url('img/btn_x.webp') no-repeat center center;
                background-size: contain;
                font-size: 0;
                color: transparent;
            }

            .close-btn:hover {
                background-image: url('img/btn_x.webp');
                background-color: rgba(0, 0, 0, 0.3);
                background-blend-mode: darken;
            }
        }
        /*
        =================================
        ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¡¨ç¤º
        =================================
        */
        .update-version {
            position: absolute;
            bottom: 10px;
            left: 10px;
            font-size: 12px;
            color: #666;
            background: rgba(255, 255, 255, 0.8);
            padding: 4px 8px;
            border-radius: 4px;
            z-index: 10;
        }

        @media (max-width: 768px) {
            .update-version {
                font-size: 10px;
                bottom: 5px;
                left: 5px;
                padding: 2px 6px;
            }
        }
        /*
        =================================
        è¨€èªåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³
        =================================
        */
        .language-selector {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 14px;
        }

        .language-selector label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            color: #666;
        }

        .language-selector input[type="radio"] {
            margin: 0;
        }

        @media (max-width: 768px) {
            .language-selector {
                gap: 10px;
                font-size: 12px;
            }
        }
		/*
        =================================
        æ¤œç´¢ã‚ªãƒ—ã‚·ãƒ§ãƒ³
        =================================
        */
        .search-options {
            margin: 10px 0 5px 0;
        }

        .search-checkboxes {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .search-checkboxes label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            color: #666;
            font-size: 14px;
            white-space: nowrap;
        }

        .search-checkboxes input[type="checkbox"] {
            margin: 0;
            cursor: pointer;
        }

        .search-checkboxes input[type="checkbox"]:checked + span,
        .search-checkboxes label:has(input[type="checkbox"]:checked) {
            color: #29b6f6;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .search-checkboxes {
                gap: 10px;
                font-size: 12px;
            }

            .search-checkboxes label {
                font-size: 12px;
            }
        }

        /*
        =================================
        ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãƒœã‚¿ãƒ³
        =================================
        */
        .version-filter-btn {
            padding: 5px 15px;
            border: 2px solid #29b6f6;
            border-radius: 15px;
            background: white;
            color: #29b6f6;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .version-filter-btn:hover {
            background: #e3f2fd;
        }

        .version-filter-btn.active {
            background: #29b6f6;
            color: white;
        }

        @media (max-width: 768px) {
            .version-filter-btn {
                padding: 4px 12px;
                font-size: 12px;
            }
        }

        /*
        =================================
        æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹
        =================================
        */
        .search-container {
            position: relative;
            margin: 10px 0;
        }

        #searchBox {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            background: white;
        }

        #searchBox:focus {
            border-color: #29b6f6;
            box-shadow: 0 0 10px rgba(41, 182, 246, 0.3);
        }

        .search-clear-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.1);
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .search-clear-btn:hover {
            background: rgba(0, 0, 0, 0.2);
            color: #333;
        }

        @media (max-width: 768px) {
            #searchBox {
                font-size: 14px;
                padding: 8px 35px 8px 12px;
            }

            .search-clear-btn {
                width: 20px;
                height: 20px;
                font-size: 14px;
                right: 8px;
            }
        }
    </style>
</head>

<body>
    <div class="update-version">Ver. 13.5<br>ê°±ì‹ ì¼ 2026ë…„1ì›”1ì¼</div>
    <div class="book-frame">
<div class="inventory-container">
<div class="header">
    <button class="header-toggle-btn" id="headerToggleBtn" onclick="inventoryUI.toggleHeader()">â–²</button>
    <div class="header-content" id="headerContent">
        <div class="title">
            ğŸ“– ë³´ë¬¼ë„ê°
            <div class="language-selector">
                <label><input type="radio" name="language" value="ja" onchange="switchLanguage(this.value)"> æ—¥æœ¬èª</label>
                <label><input type="radio" name="language" value="ko" checked onchange="switchLanguage(this.value)"> í•œêµ­ì–´</label>
            </div>
        </div>
        <div class="search-options">
            <div class="search-checkboxes">
                <button class="version-filter-btn" id="versionFilterBtn133" onclick="inventoryUI.toggleVersionFilter('13.3')">Ver 13.3</button>
                <button class="version-filter-btn" id="versionFilterBtn134" onclick="inventoryUI.toggleVersionFilter('13.4')">Ver 13.4</button>
                <div style="width: 100%; height: 0;"></div>
                <label><input type="checkbox" id="searchName" checked onchange="inventoryUI.onSearchOptionChange()"> ë³´ë¬¼ëª…</label>
                <label><input type="checkbox" id="searchEffect" checked onchange="inventoryUI.onSearchOptionChange()"> ì¥ì°©íš¨ê³¼</label>
                <label><input type="checkbox" id="searchMethod" onchange="inventoryUI.onSearchOptionChange()"> ìˆ˜ì§‘ë°©ë²•</label>
                <label><input type="checkbox" id="searchDescription" onchange="inventoryUI.onSearchOptionChange()"> ì„¤ëª…</label>
            </div>
        </div>
        <div class="search-container">
            <input type="text" id="searchBox" placeholder="ê²€ìƒ‰í•  ë¬¸ì ì…ë ¥..." onInput="inventoryUI.performSearch(this.value)">
            <button class="search-clear-btn" id="searchClearBtn" onclick="inventoryUI.clearSearch()" style="display: none;">Ã—</button>
        </div>
    </div>
        <div class="tab-buttons">
            <button class="tab-btn active" id="generalTab" onclick="switchTab('general')">ì¼ë°˜ë³´ë¬¼</button>
            <button class="tab-btn" id="evolutionTab" onclick="switchTab('evolution')">ì§„í™”ë³´ë¬¼</button>
            <button class="tab-btn" id="blessedTab" onclick="switchTab('blessed')">ì¶•ë³µë³´ë¬¼</button>
        </div>
</div>

            <div class="item-count-display" id="itemCountDisplay">ë³´ë¬¼ìˆ˜: 0ê°œ</div>
            <div class="inventory-grid" id="inventoryGrid">
                <!-- ã‚¢ã‚¤ãƒ†ãƒ ãŒJavaScriptã§å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
            </div>
        </div>
    </div>

    <div class="popup-overlay" id="popupOverlay">
        <div class="popup" id="popup">
            <button class="share-btn" id="shareBtn" onclick="inventoryUI.shareItem()">ğŸ”—ê³µìœ </button>
            <button class="copy-korean-btn" id="copyKoreanBtn" style="display: none;">ğŸ”ë³´ë¬¼ëª… ë³µì‚¬</button>
            <button class="close-btn" onclick="closePopup()"></button>
            <div class="popup-header">
                <div class="popup-icon" id="popupIcon"></div>
                <div class="popup-title" id="popupTitle"></div>
            </div>
            <div class="popup-section">
                <div class="popup-section-title">ì¥ì°©íš¨ê³¼</div>
                <div class="popup-description" id="popupEffect"></div>
            </div>
            <div class="popup-section">
                <div class="popup-section-title">ìˆ˜ì§‘ë°©ë²•</div>
                <div class="popup-description" id="popupMethod"></div>
            </div>
            <div class="popup-section" id="evolutionSection" style="display: none;">
                <div class="popup-section-title">ì§„í™”ê°€ëŠ¥í•œë³´ë¬¼</div>
                <div class="popup-description" id="popupEvolution"></div>
            </div>
        </div>
    </div>
    <script src="data_ko.js"></script>
    <script>
        /*
        =================================
        ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        =================================
        */
        // éŸ“å›½èªåã‚’å–å¾—ã™ã‚‹é–¢æ•°
        function getKoreanName(itemId) {
            // å…¨ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰æ¤œç´¢
            for (let category of ['general', 'evolution', 'blessed']) {
                const koItem = ITEM_DATA_KO[category].find(item => item.id === itemId);
                if (koItem) {
                    return koItem.name;
                }
            }
            return null; // è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
        }

        // ã‚¢ã‚¤ãƒ†ãƒ ç”»åƒãƒ‘ã‚¹ç”Ÿæˆé–¢æ•°
        function getItemImagePath(itemId, isEvolved = false) {
            // ç¥ç¦å®ç‰©ã®å ´åˆã€é€²åŒ–å®ç‰©ã¨åŒã˜ç”»åƒã‚’ä½¿ç”¨
            if (itemId.includes('_blessed')) {
                const baseId = itemId.replace('_blessed', '');
                return `img/${baseId}.webp`;
            }
            return `img/${itemId}.webp`;
        }

        // ãƒ•ãƒ¬ãƒ¼ãƒ ç”»åƒãƒ‘ã‚¹ç”Ÿæˆé–¢æ•°
        function getFrameImagePath(rarity, tabType = 'general') {
            const rarityLower = rarity.toLowerCase();
            if (tabType === 'evolution') {
                return `img/treasure_mix_frame_${rarityLower}.webp`;
            } else if (tabType === 'blessed') {
                return `img/treasure_mix_frame_${rarityLower}.webp`;
            }
            return `img/treasure_frame_${rarityLower}.webp`;
        }

        // ç¥ç¦ã‚¨ãƒ•ã‚§ã‚¯ãƒˆç”»åƒãƒ‘ã‚¹ç”Ÿæˆé–¢æ•°
        function getBlessingEffectPath(rarity) {
            if (rarity === 'S') {
                return 'img/treasure_frame_effect05.webp';
            }
            return 'img/treasure_frame_effect07.webp';
        }
        // ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã«ã‚ˆã‚‹è‰²å–å¾—
        function getRarityColor(rarity) {
            switch (rarity) {
                case 'C': return '#808080';  // ç°è‰²
                case 'B': return '#4fc3f7';  // é’è‰²
                case 'A': return '#FF9800';  // ã‚ªãƒ¬ãƒ³ã‚¸è‰²
                case 'S': return '#9C27B0';  // ç´«è‰²
                case 'U': return '#191919';  // é»’è‰²
                default: return '#808080';
            }
        }

        /*
        =================================
        UIç®¡ç†ã‚¯ãƒ©ã‚¹
        =================================
        */
        // UIç®¡ç†ã‚¯ãƒ©ã‚¹
        class InventoryUI {
            constructor() {
                this.currentTab = 'general';
                this.currentPopupItem = null;
                this.popupHistory = []; // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®å±¥æ­´ã‚’ç®¡ç†
                this.popupSource = null; // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ç™ºç”Ÿæºã‚’è¨˜éŒ²
                this.scrollPositions = { // å„ã‚¿ãƒ–ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’ä¿æŒ
                    general: 0,
                    evolution: 0,
                    blessed: 0
                };
                this.isSearching = false; // æ¤œç´¢ä¸­ã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°
                this.searchResults = { // æ¤œç´¢çµæœã‚’ä¿æŒ
                    general: [],
                    evolution: [],
                    blessed: []
                };
                this.originalData = null; // å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ
                this.searchOptions = { // æ¤œç´¢ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹
                    name: true,
                    effect: true,
                    method: false,
                    description: false
                };
                this.isHeaderCollapsed = false; // ãƒ˜ãƒƒãƒ€ãƒ¼ã®é–‹é–‰çŠ¶æ…‹
                this.isVersionFiltered = false; // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ•ã‚£ãƒ«ã‚¿çŠ¶æ…‹
                this.currentVersion = null; // ç¾åœ¨ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒãƒ¼ã‚¸ãƒ§ãƒ³
            }

            /*
            =================================
            ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‚°ãƒªãƒƒãƒ‰é–¢é€£ãƒ¡ã‚½ãƒƒãƒ‰
            =================================
            */
            // ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã«ã‚ˆã‚‹ã‚½ãƒ¼ãƒˆé †åºã‚’å®šç¾©
            getRaritySortOrder(rarity) {
                const order = { 'S': 1, 'A': 2, 'B': 3, 'C': 4, 'U': 5 };
                return order[rarity] || 999;
            }

            // ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‚°ãƒªãƒƒãƒ‰ã‚’ä½œæˆ
            createInventoryGrid(items) {
                const grid = document.getElementById('inventoryGrid');
                grid.innerHTML = '';

                // ã‚¢ã‚¤ãƒ†ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’(ãƒ¬ã‚¢ãƒªãƒ†ã‚£â†’ãƒ€ãƒŸãƒ¼ãƒ•ãƒ©ã‚°â†’ãƒ‘ãƒƒã‚·ãƒ–ã‚¿ã‚°â†’booknoneâ†’ã‚¢ã‚¤ãƒ†ãƒ ãƒ‡ãƒ¼ã‚¿é…åˆ—é †)ã§ã‚½ãƒ¼ãƒˆ
                const sortedItems = [...items].sort((a, b) => {
                    // 1. ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã§ã‚½ãƒ¼ãƒˆï¼ˆSâ†’Aâ†’Bâ†’Cé †ï¼‰
                    const orderA = this.getRaritySortOrder(a.rarity);
                    const orderB = this.getRaritySortOrder(b.rarity);

                    if (orderA !== orderB) {
                        return orderA - orderB;
                    }

                    // 2. åŒã˜ãƒ¬ã‚¢ãƒªãƒ†ã‚£å†…ã§ã¯ãƒ€ãƒŸãƒ¼ãƒ•ãƒ©ã‚°ã§ã‚½ãƒ¼ãƒˆï¼ˆå®Ÿãƒ‡ãƒ¼ã‚¿ãŒå…ˆï¼‰
                    const isDummyA = a.isDummy || false;
                    const isDummyB = b.isDummy || false;

                    if (isDummyA !== isDummyB) {
                        return isDummyA - isDummyB; // false(0) ãŒå…ˆã€true(1) ãŒå¾Œ
                    }

                    // 3. åŒã˜ãƒ¬ã‚¢ãƒªãƒ†ã‚£ãƒ»ãƒ€ãƒŸãƒ¼ãƒ•ãƒ©ã‚°å†…ã§ã¯booknoneã§ã‚½ãƒ¼ãƒˆï¼ˆbooknoneãªã—ãŒå…ˆã€booknoneã‚ã‚ŠãŒå¾Œï¼‰
                    const hasBooknoneA = a.booknone || false;
                    const hasBooknoneB = b.booknone || false;

                    if (hasBooknoneA !== hasBooknoneB) {
                        return hasBooknoneA - hasBooknoneB; // false(0) ãŒå…ˆã€true(1) ãŒå¾Œ
                    }

                    // 4. åŒã˜ãƒ¬ã‚¢ãƒªãƒ†ã‚£ãƒ»ãƒ€ãƒŸãƒ¼ãƒ•ãƒ©ã‚°ãƒ»booknoneå†…ã§ã¯ãƒ‘ãƒƒã‚·ãƒ–ã‚¿ã‚°ã§ã‚½ãƒ¼ãƒˆï¼ˆãƒ‘ãƒƒã‚·ãƒ–ã‚¿ã‚°ãªã—ãŒå…ˆã€ãƒ‘ãƒƒã‚·ãƒ–ã‚¿ã‚°ã‚ã‚ŠãŒå¾Œï¼‰
                    const hasPassiveA = a.hasPassiveTag || false;
                    const hasPassiveB = b.hasPassiveTag || false;

                    if (hasPassiveA !== hasPassiveB) {
                        return hasPassiveA - hasPassiveB; // false(0) ãŒå…ˆã€true(1) ãŒå¾Œ
                    }

                    // 5. æœ€å¾Œã«ã‚¢ã‚¤ãƒ†ãƒ ãƒ‡ãƒ¼ã‚¿é…åˆ—é †ã§ã‚½ãƒ¼ãƒˆï¼ˆå…ƒã®é…åˆ—é †åºã‚’ç¶­æŒï¼‰
                    const indexA = items.indexOf(a);
                    const indexB = items.indexOf(b);

                    return indexA - indexB;
                });
                sortedItems.forEach(item => {
                    const slot = this.createItemSlot(item);
                    grid.appendChild(slot);
                });

                this.updateItemCount(sortedItems.length);
            }

            // ã‚¢ã‚¤ãƒ†ãƒ ã‚¹ãƒ­ãƒƒãƒˆã‚’ä½œæˆ
            createItemSlot(item) {
                const slot = document.createElement('div');
                slot.className = `item-slot ${item.rarity}`;
                slot.onclick = () => this.showItemPopup(item);

                // ãƒ•ãƒ¬ãƒ¼ãƒ ç”»åƒ
                const frameImage = document.createElement('div');
                frameImage.className = 'item-frame';
                frameImage.style.backgroundImage = `url('${getFrameImagePath(item.rarity, this.currentTab)}')`;

                // ã‚¢ã‚¤ãƒ†ãƒ ç”»åƒ
                const itemImage = document.createElement('div');
                itemImage.className = 'item-image';
                const isEvolved = this.currentTab === 'evolution' || this.currentTab === 'blessed';
                itemImage.style.backgroundImage = `url('${getItemImagePath(item.id, isEvolved)}')`;

                // ç¥ç¦å®ç‰©ã®å ´åˆã€z-indexã‚’è¨­å®šã—ã¦å›è»¢ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚ˆã‚Šä¸Šã«è¡¨ç¤º
                if (this.currentTab === 'blessed') {
                    itemImage.style.zIndex = '4';
                }

                slot.appendChild(frameImage);
                slot.appendChild(itemImage);

                // ç¥ç¦å®ç‰©ã®å ´åˆã€å›è»¢ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ 
                if (this.currentTab === 'blessed') {
                    const blessingEffect = document.createElement('div');
                    blessingEffect.className = 'blessing-effect';
                    blessingEffect.style.backgroundImage = `url('${getBlessingEffectPath(item.rarity)}')`;
                    slot.appendChild(blessingEffect);
                }

                // ãƒ‘ãƒƒã‚·ãƒ–ã‚¿ã‚°ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ï¼ˆä¸€ç•ªä¸Šã«è¡¨ç¤ºï¼‰
                if (item.hasPassiveTag) {
                    const passiveTagEffect = document.createElement('div');
                    passiveTagEffect.className = 'passive-tag-effect';
                    passiveTagEffect.style.backgroundImage = `url('img/treasure_tag_passive_ko.webp')`;
                    slot.appendChild(passiveTagEffect);
                }

                // Useã‚¿ã‚°ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ï¼ˆãƒ‘ãƒƒã‚·ãƒ–ã‚¿ã‚°ã¨åŒã˜ä½ç½®ã«è¡¨ç¤ºï¼‰
                if (item.hasUseTag) {
                    const useTagEffect = document.createElement('div');
                    useTagEffect.className = 'passive-tag-effect'; // åŒã˜ã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨
                    useTagEffect.style.backgroundImage = `url('img/treasure_tag_use_ko.webp')`;
                    slot.appendChild(useTagEffect);
                }

                // Sãƒ©ãƒ³ã‚¯ã®ç¥ç¦å®ç‰©ã®å ´åˆã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ï¼ˆæœ€ä¸Šä½ã«è¡¨ç¤ºï¼‰
                if (this.currentTab === 'blessed' && item.rarity === 'S') {
                    const effectAnimation = document.createElement('div');
                    effectAnimation.className = 'effect-animation';
                    slot.appendChild(effectAnimation);
                }

                return slot;
            }

            /*
            =================================
            ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—é–¢é€£ãƒ¡ã‚½ãƒƒãƒ‰
            =================================
            */
            // ã‚¢ã‚¤ãƒ†ãƒ è©³ç´°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤º
            showItemPopup(item, source = 'grid') {
                // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‹ãå‰ã«ç¾åœ¨ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’ä¿å­˜
                const grid = document.getElementById('inventoryGrid');
                if (grid && source === 'grid') {
                    this.scrollPositions[this.currentTab] = grid.scrollTop;
                }

                this.currentPopupItem = item;
                this.popupSource = source;

                // å±¥æ­´ã‚’ç®¡ç†ï¼ˆã‚°ãƒªãƒƒãƒ‰ã‹ã‚‰é–‹ã„ãŸå ´åˆã®ã¿å±¥æ­´ã«è¿½åŠ ï¼‰
                if (source === 'grid') {
                    this.popupHistory = [item];
                } else if (source === 'evolution' || source === 'blessed') {
                    this.popupHistory.push(item);
                }

                const overlay = document.getElementById('popupOverlay');
                const popup = document.getElementById('popup');
                const icon = document.getElementById('popupIcon');
                const title = document.getElementById('popupTitle');
                const effect = document.getElementById('popupEffect');
                const method = document.getElementById('popupMethod');
                const evolutionSection = document.getElementById('evolutionSection');
                const evolution = document.getElementById('popupEvolution');

                // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ä¸€ç•ªä¸Šã«æˆ»ã™
                popup.scrollTop = 0;

                // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
                popup.classList.remove('evolved', 'blessed');
                icon.classList.remove('evolved');

                // é€²åŒ–å¾Œã‚¢ã‚¤ãƒ†ãƒ ã®å ´åˆã€é»„è‰²èƒŒæ™¯ã‚’é©ç”¨
                const isEvolved = this.currentTab === 'evolution';
                const isBlessed = this.currentTab === 'blessed';
                if (isEvolved) {
                    popup.classList.add('evolved');
                    icon.classList.add('evolved');
                } else if (isBlessed) {
                    popup.classList.add('blessed');
                    icon.classList.add('evolved');
                }

                // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚¢ã‚¤ã‚³ãƒ³è¨­å®šï¼ˆãƒ•ãƒ¬ãƒ¼ãƒ ä»˜ãï¼‰
                const frameImageUrl = getFrameImagePath(item.rarity, this.currentTab);
                const itemImageUrl = getItemImagePath(item.id, isEvolved || isBlessed);

                icon.style.backgroundImage = `url('${frameImageUrl}')`;

                let iconHTML = `<div class="popup-item-image" style="background-image: url('${itemImageUrl}'); z-index: 4;"></div>`;

                // ç¥ç¦å®ç‰©ã®å ´åˆã€å›è»¢ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ 
                if (isBlessed) {
                    const blessingEffectUrl = getBlessingEffectPath(item.rarity);
                    iconHTML += `<div class="popup-blessing-effect" style="background-image: url('${blessingEffectUrl}'); z-index: 3;"></div>`;
                }

                // ãƒ‘ãƒƒã‚·ãƒ–ã‚¿ã‚°ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ï¼ˆä¸€ç•ªä¸Šã«è¡¨ç¤ºï¼‰
                if (item.hasPassiveTag) {
                    iconHTML += `<div class="popup-passive-tag-effect" style="background-image: url('img/treasure_tag_passive_ko.webp'); z-index: 5;"></div>`;
                }

                // Useã‚¿ã‚°ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ï¼ˆä¸€ç•ªä¸Šã«è¡¨ç¤ºï¼‰
                if (item.hasUseTag) {
                    iconHTML += `<div class="popup-passive-tag-effect" style="background-image: url('img/treasure_tag_use_ko.webp'); z-index: 5;"></div>`;
                }

                // Sãƒ©ãƒ³ã‚¯ã®ç¥ç¦å®ç‰©ã®å ´åˆã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ï¼ˆæœ€ä¸Šä½ã«è¡¨ç¤ºï¼‰
                if (isBlessed && item.rarity === 'S') {
                    iconHTML += `<div class="popup-effect-animation" style="z-index: 6;"></div>`;
                }

                icon.innerHTML = iconHTML;

                // ã‚¢ã‚¤ãƒ†ãƒ åã«è‰²ã‚’é©ç”¨
                title.textContent = item.name; //æ”¹è¡Œã—ãªã„
                title.style.color = getRarityColor(item.rarity);

                // éŸ“å›½èªåã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã®è¨­å®š
                const copyKoreanBtn = document.getElementById('copyKoreanBtn');
                const koreanName = getKoreanName(item.id);

                if (koreanName) {
                    copyKoreanBtn.style.display = 'block';
                    copyKoreanBtn.textContent = 'ğŸ”ë³´ë¬¼ëª… ë³µì‚¬';
                    copyKoreanBtn.classList.remove('copied');
                    copyKoreanBtn.onclick = () => {
                        // æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã«å¤‰æ›
                        let processedName = koreanName.replace(/\\n/g, ' ').replace(/\n/g, ' ');

                        // 17æ–‡å­—ä»¥ä¸Šã®å ´åˆã¯16æ–‡å­—ã¾ã§åˆ‡ã‚Šå–ã‚Š
                        if (processedName.length > 16) {
                            processedName = processedName.substring(0, 16);
                        }

                        // ä»£æ›¿ã‚³ãƒ”ãƒ¼æ–¹æ³•(å¤ã„ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œ)
                        const textArea = document.createElement('textarea');
                        textArea.value = processedName;
                        textArea.style.position = 'fixed';
                        textArea.style.left = '-999999px';
                        textArea.style.top = '-999999px';
                        document.body.appendChild(textArea);
                        textArea.focus();
                        textArea.select();

                        try {
                            document.execCommand('copy');
                            textArea.remove();

                            // ã‚³ãƒ”ãƒ¼æˆåŠŸã®è¡¨ç¤º
                            copyKoreanBtn.textContent = 'âœ“';
                            copyKoreanBtn.classList.add('copied');

                            // 2ç§’å¾Œã«å…ƒã«æˆ»ã™
                            setTimeout(() => {
                                copyKoreanBtn.textContent = 'ğŸ”ë³´ë¬¼ëª… ë³µì‚¬';
                                copyKoreanBtn.classList.remove('copied');
                            }, 2000);
                        } catch (err) {
                            console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ:', err);
                            textArea.remove();
                            alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                        }
                    };
                } else {
                    copyKoreanBtn.style.display = 'none';
                }

                effect.textContent = item.effect.replace(/\\n/g, '\n'); //'/n'ã§æ”¹è¡Œã™ã‚‹
                effect.style.whiteSpace = 'pre-line';

                method.textContent = item.method.replace(/\\n/g, '\n');
                method.style.whiteSpace = 'pre-line';

                // é€²åŒ–å¯èƒ½ãªã‚¢ã‚¤ãƒ†ãƒ ã®å ´åˆ
                if (item.canEvolve) {
                    evolutionSection.style.display = 'block';

                    let nextEvolutionItem = null;
                    if (this.currentTab === 'general') {
                        nextEvolutionItem = this.findEvolvedItem(item.id);
                        evolutionSection.querySelector('.popup-section-title').textContent = 'ì§„í™”ê°€ëŠ¥í•œë³´ë¬¼';
                    } else if (this.currentTab === 'evolution') {
                        nextEvolutionItem = this.findBlessedItem(item.id);
                        evolutionSection.querySelector('.popup-section-title').textContent = 'ì¶•ë³µë°›ì€ë³´ë¬¼';
                    }

                    if (nextEvolutionItem) {
                        evolution.innerHTML = this.createEvolutionPreview(nextEvolutionItem);
                    }
                } else {
                    evolutionSection.style.display = 'none';
                }

                // ã‚¢ã‚¤ãƒ†ãƒ èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
                this.addDescriptionSection(item);

                overlay.classList.add('show');
            }
            // ã‚¢ã‚¤ãƒ†ãƒ èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
            addDescriptionSection(item) {
                // æ—¢å­˜ã®èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤
                const existingDescSection = document.getElementById('descriptionSection');
                if (existingDescSection) {
                    existingDescSection.remove();
                }

                const popup = document.getElementById('popup');
                const evolutionSection = document.getElementById('evolutionSection');

                // èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
                const descSection = document.createElement('div');
                descSection.id = 'descriptionSection';
                descSection.className = 'popup-section';
                const description = item.description || 'ã‚¢ã‚¤ãƒ†ãƒ ã®èª¬æ˜ãŒã‚ã‚Šã¾ã›ã‚“ã€‚';
                const formattedDescription = description.replace(/\\n/g, '\n');
                descSection.innerHTML = `
                <div class="popup-section-title">ì„¤ëª…</div>
                <div class="popup-description" style="white-space: pre-line;">${formattedDescription}</div>
                `;

                // é€²åŒ–å¯èƒ½ã‚¢ã‚¤ãƒ†ãƒ ã§é€²åŒ–ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯é€²åŒ–ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å¾Œã«è¿½åŠ 
                if (item.canEvolve && evolutionSection.style.display !== 'none') {
                    evolutionSection.insertAdjacentElement('afterend', descSection);
                } else {
                    // ãã‚Œä»¥å¤–ã®å ´åˆã¯ã€å…¥æ‰‹æ–¹æ³•ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ¢ã—ã¦å¾Œã«è¿½åŠ 
                    const allSections = popup.querySelectorAll('.popup-section');
                    let methodSection = null;

                    // å…¥æ‰‹æ–¹æ³•ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ¢ã™
                    for (let section of allSections) {
                        const title = section.querySelector('.popup-section-title');
                        if (title && title.textContent === 'å…¥æ‰‹æ–¹æ³•') {
                            methodSection = section;
                            break;
                        }
                    }

                    if (methodSection) {
                        methodSection.insertAdjacentElement('afterend', descSection);
                    } else {
                        // è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯æœ€å¾Œã«è¿½åŠ 
                        popup.appendChild(descSection);
                    }
                }
            }
            // é€²åŒ–ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼HTMLä½œæˆ
            createEvolutionPreview(evolvedItem) {
                // ç¥ç¦å®ç‰©ã‹ã©ã†ã‹ã‚’åˆ¤å®š
                const isBlessed = ITEM_DATA_KO.blessed.some(item => item.id === evolvedItem.id);
                const tabType = isBlessed ? 'blessed' : 'evolution';

                let iconHTML = `<div class="evolution-item-image" style="background-image: url('${getItemImagePath(evolvedItem.id, true)}'); z-index: 4;"></div>`;

                // ç¥ç¦å®ç‰©ã®å ´åˆã®ã¿ã€å›è»¢ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ 
                if (isBlessed) {
                    const blessingEffectUrl = getBlessingEffectPath(evolvedItem.rarity);
                    iconHTML += `<div class="blessing-effect" style="background-image: url('${blessingEffectUrl}'); z-index: 3;"></div>`;
                }

                // ãƒ‘ãƒƒã‚·ãƒ–ã‚¿ã‚°ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ï¼ˆä¸€ç•ªä¸Šã«è¡¨ç¤ºï¼‰
                if (evolvedItem.hasPassiveTag) {
                    iconHTML += `<div class="passive-tag-effect" style="background-image: url('img/treasure_tag_passive_ko.webp'); z-index: 5;"></div>`;
                }

                // Useã‚¿ã‚°ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ï¼ˆä¸€ç•ªä¸Šã«è¡¨ç¤ºï¼‰
                if (evolvedItem.hasUseTag) {
                    iconHTML += `<div class="passive-tag-effect" style="background-image: url('img/treasure_tag_use_ko.webp'); z-index: 5;"></div>`;
                }

                // Sãƒ©ãƒ³ã‚¯ã®ç¥ç¦å®ç‰©ã®å ´åˆã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ï¼ˆæœ€ä¸Šä½ã«è¡¨ç¤ºï¼‰
                if (isBlessed && evolvedItem.rarity === 'S') {
                    iconHTML += `<div class="effect-animation" style="z-index: 6;"></div>`;
                }

                return `
        <div class="evolution-preview" onclick="inventoryUI.showEvolvedItemPopup('${evolvedItem.id}')">
            <div class="evolution-icon" style="background-image: url('${getFrameImagePath(evolvedItem.rarity, tabType)}');">
                ${iconHTML}
            </div>
            <div>
                <div style="font-weight: bold; color: ${getRarityColor(evolvedItem.rarity)};">${evolvedItem.name}</div>
                <div style="font-size: 14px; color: #666; margin-top: 5px;">${evolvedItem.effect}</div>
            </div>
        </div>
    `;
            }
            // é€²åŒ–ã—ãŸã‚¢ã‚¤ãƒ†ãƒ ã‚’æ¤œç´¢
            findEvolvedItem(baseId) {
                return ITEM_DATA_KO.evolution.find(item => item.baseId === baseId);
            }

            // ç¥ç¦ã•ã‚ŒãŸã‚¢ã‚¤ãƒ†ãƒ ã‚’æ¤œç´¢
            findBlessedItem(baseId) {
                return ITEM_DATA_KO.blessed.find(item => item.baseId === baseId);
            }
            // é€²åŒ–ã—ãŸã‚¢ã‚¤ãƒ†ãƒ ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
            showEvolvedItemPopup(itemId) {
                // é€²åŒ–ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ¤œç´¢
                let evolvedItem = ITEM_DATA_KO.evolution.find(item => item.id === itemId);
                if (evolvedItem) {
                    // ä¸€èˆ¬å®ç‰©ã‚¿ãƒ–ã‹ã‚‰é€²åŒ–å®ç‰©ã‚’é–‹ãå ´åˆã€ã‚¿ãƒ–ã‚’ä¸€æ™‚çš„ã«åˆ‡ã‚Šæ›¿ãˆ
                    const originalTab = this.currentTab;
                    this.currentTab = 'evolution';
                    this.showItemPopup(evolvedItem, 'evolution');
                    // ã‚¿ãƒ–ã‚’å…ƒã«æˆ»ã™å¿…è¦ã¯ãªã„ï¼ˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒé–‹ã„ã¦ã„ã‚‹é–“ã¯ã‚¿ãƒ–çŠ¶æ…‹ã‚’ç¶­æŒï¼‰
                    return;
                }

                // ç¥ç¦ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ¤œç´¢
                let blessedItem = ITEM_DATA_KO.blessed.find(item => item.id === itemId);
                if (blessedItem) {
                    // é€²åŒ–å®ç‰©ã‚¿ãƒ–ã‹ã‚‰ç¥ç¦å®ç‰©ã‚’é–‹ãå ´åˆã€ã‚¿ãƒ–ã‚’ä¸€æ™‚çš„ã«åˆ‡ã‚Šæ›¿ãˆ
                    const originalTab = this.currentTab;
                    this.currentTab = 'blessed';
                    this.showItemPopup(blessedItem, 'blessed');
                    return;
                }
            }
            // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
            closePopup() {
                const overlay = document.getElementById('popupOverlay');
                const popup = document.getElementById('popup');
                const icon = document.getElementById('popupIcon');

                // å±¥æ­´ãŒ2ã¤ä»¥ä¸Šã‚ã‚‹å ´åˆï¼ˆé€šå¸¸å®ç‰©â†’é€²åŒ–å®ç‰©ã®é †ã§é–‹ã„ãŸå ´åˆï¼‰
                if (this.popupHistory.length >= 2) {
                    // æœ€å¾Œã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤
                    this.popupHistory.pop();

                    // å…ƒã®ã‚¢ã‚¤ãƒ†ãƒ ï¼ˆé€šå¸¸å®ç‰©ï¼‰ã‚’è¡¨ç¤º
                    const previousItem = this.popupHistory[this.popupHistory.length - 1];

                    // å…ƒã®ã‚¿ãƒ–ã«æˆ»ã™
                    if (this.popupHistory.length === 1) {
                        // æœ€åˆã®ã‚¢ã‚¤ãƒ†ãƒ ã®å ´åˆã€ãã®ã‚¢ã‚¤ãƒ†ãƒ ãŒå±ã™ã‚‹ã‚¿ãƒ–ã«æˆ»ã™
                        if (ITEM_DATA_KO.general.some(item => item.id === previousItem.id)) {
                            this.currentTab = 'general';
                        } else if (ITEM_DATA_KO.evolution.some(item => item.id === previousItem.id)) {
                            this.currentTab = 'evolution';
                        } else if (ITEM_DATA_KO.blessed.some(item => item.id === previousItem.id)) {
                            this.currentTab = 'blessed';
                        }
                    } else {
                        // 2ã¤ä»¥ä¸Šã‚ã‚‹å ´åˆã¯ã€å‰ã®ã‚¢ã‚¤ãƒ†ãƒ ãŒæ‰€å±ã™ã‚‹ã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆã‚‹
                        if (ITEM_DATA_KO.general.some(item => item.id === previousItem.id)) {
                            this.currentTab = 'general';
                        } else if (ITEM_DATA_KO.evolution.some(item => item.id === previousItem.id)) {
                            this.currentTab = 'evolution';
                        } else if (ITEM_DATA_KO.blessed.some(item => item.id === previousItem.id)) {
                            this.currentTab = 'blessed';
                        }
                    }

                    this.showItemPopup(previousItem, 'history');
                    return;
                }

                // é€šå¸¸ã®é–‰ã˜ã‚‹å‡¦ç†
                overlay.classList.remove('show');
                popup.classList.remove('evolved', 'blessed');
                icon.classList.remove('evolved');

                // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®å…¨ã¦ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å®Œå…¨ã«ã‚¯ãƒªã‚¢
                icon.innerHTML = '';
                icon.style.backgroundImage = '';
                document.getElementById('popupTitle').textContent = '';
                document.getElementById('popupTitle').style.color = '';
                document.getElementById('copyKoreanBtn').style.display = 'none';
                document.getElementById('popupEffect').textContent = '';
                document.getElementById('popupEffect').style.whiteSpace = '';
                document.getElementById('popupMethod').textContent = '';
                document.getElementById('popupEvolution').innerHTML = '';
                document.getElementById('evolutionSection').style.display = 'none';

                // å‹•çš„ã«è¿½åŠ ã•ã‚ŒãŸèª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤
                const existingDescSection = document.getElementById('descriptionSection');
                if (existingDescSection) {
                    existingDescSection.remove();
                }

                // çŠ¶æ…‹ã‚’å®Œå…¨ã«ãƒªã‚»ãƒƒãƒˆ
                this.currentPopupItem = null;
                this.popupHistory = [];
                this.popupSource = null;
            }

            // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
            switchTab(tabName) {
                const grid = document.getElementById('inventoryGrid');

                // ç¾åœ¨ã®ã‚¿ãƒ–ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’ä¿å­˜
                if (this.currentTab && grid) {
                    this.scrollPositions[this.currentTab] = grid.scrollTop;
                }

                this.currentTab = tabName;

                // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
                document.getElementById('generalTab').classList.toggle('active', tabName === 'general');
                document.getElementById('evolutionTab').classList.toggle('active', tabName === 'evolution');
                document.getElementById('blessedTab').classList.toggle('active', tabName === 'blessed');

                // ã‚¢ã‚¤ãƒ†ãƒ ãƒªã‚¹ãƒˆæ›´æ–°ï¼ˆæ¤œç´¢ä¸­ã®å ´åˆã¯æ¤œç´¢çµæœã‚’ã€ãã†ã§ãªã‘ã‚Œã°å…¨ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºï¼‰
                const items = this.isSearching ? this.searchResults[tabName] : ITEM_DATA_KO[tabName];
                this.createInventoryGrid(items);

                // ä¿å­˜ã•ã‚ŒãŸã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’å¾©å…ƒ
                if (grid && this.scrollPositions[tabName] !== undefined) {
                    // å°‘ã—é…å»¶ã‚’ã‹ã‘ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’å¾©å…ƒï¼ˆDOMæ›´æ–°å¾Œã«å®Ÿè¡Œï¼‰
                    setTimeout(() => {
                        grid.scrollTop = this.scrollPositions[tabName];
                    }, 10);
                }
            }
            // ã‚¢ã‚¤ãƒ†ãƒ æ•°æ›´æ–°
            updateItemCount(count) {
                const itemCountDisplay = document.getElementById('itemCountDisplay');
                if (itemCountDisplay) {
                    itemCountDisplay.textContent = `ë³´ë¬¼ìˆ˜: ${count}ê°œ`;
                }
            }

            // åˆæœŸåŒ–
            init() {
                this.switchTab('general');
                this.setupEventListeners();
                this.addCustomStyles();
            }

            // ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ 
            addCustomStyles() {
                const style = document.createElement('style');
                document.head.appendChild(style);
            }

            // æ¤œç´¢å®Ÿè¡Œ
            performSearch(searchTerm) {
                const searchBox = document.getElementById('searchBox');
                const clearBtn = document.getElementById('searchClearBtn');

                if (!searchTerm.trim()) {
                    // æ¤œç´¢èªãŒç©ºã®å ´åˆã€æ¤œç´¢ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹
                    this.clearSearch();
                    return;
                }

                // ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                clearBtn.style.display = 'block';

                this.isSearching = true;
                const searchTerms = searchTerm.toLowerCase().split(/\s+/).filter(term => term.length > 0);

                // å„ã‚«ãƒ†ã‚´ãƒªã§æ¤œç´¢ã‚’å®Ÿè¡Œ
                ['general', 'evolution', 'blessed'].forEach(category => {
                    // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãŒæœ‰åŠ¹ãªå ´åˆã¯ã€ãƒ•ã‚£ãƒ«ã‚¿æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ¤œç´¢
                    const sourceData = this.isVersionFiltered 
                        ? ITEM_DATA_KO[category].filter(item => {
                            const versionIds = VERSION_DATA_KO[this.currentVersion] || [];
                            return versionIds.includes(item.id);
                        })
                        : ITEM_DATA_KO[category];

                        this.searchResults[category] = sourceData.filter(item => {
                        // ãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸé …ç›®ã‹ã‚‰æ¤œç´¢å¯¾è±¡ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’åé›†
                        const searchTargets = [];

                        if (this.searchOptions.name) {
                            searchTargets.push(item.name.toLowerCase());
                        }
                        if (this.searchOptions.effect) {
                            searchTargets.push(item.effect.toLowerCase());
                        }
                        if (this.searchOptions.method) {
                            searchTargets.push(item.method.toLowerCase());
                        }
                        if (this.searchOptions.description && item.description) {
                            searchTargets.push(item.description.toLowerCase());
                        }

                        // æ¤œç´¢å¯¾è±¡ãŒãªã„å ´åˆã¯false
                        if (searchTargets.length === 0) {
                            return false;
                        }

                        // å…¨ã¦ã®æ¤œç´¢èªãŒã€ã„ãšã‚Œã‹ã®æ¤œç´¢å¯¾è±¡ã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆANDæ¤œç´¢ï¼‰
                        return searchTerms.every(searchTerm => {
                            return searchTargets.some(target => target.includes(searchTerm));
                        });
                    });
                });

                // ç¾åœ¨ã®ã‚¿ãƒ–ã‚’å†æç”»
                this.switchTab(this.currentTab);
            }

            // æ¤œç´¢ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®å¤‰æ›´æ™‚
            onSearchOptionChange() {
                // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚’æ›´æ–°
                this.searchOptions.name = document.getElementById('searchName').checked;
                this.searchOptions.effect = document.getElementById('searchEffect').checked;
                this.searchOptions.method = document.getElementById('searchMethod').checked;
                this.searchOptions.description = document.getElementById('searchDescription').checked;

                // æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã«å€¤ãŒã‚ã‚‹å ´åˆã¯å†æ¤œç´¢
                const searchBox = document.getElementById('searchBox');
                if (searchBox.value.trim()) {
                    this.performSearch(searchBox.value);
                }
            }

            // ãƒ˜ãƒƒãƒ€ãƒ¼ã®é–‹é–‰åˆ‡ã‚Šæ›¿ãˆ
            toggleHeader() {
                const headerContent = document.getElementById('headerContent');
                const toggleBtn = document.getElementById('headerToggleBtn');
                const header = document.querySelector('.header');

                this.isHeaderCollapsed = !this.isHeaderCollapsed;

                if (this.isHeaderCollapsed) {
                    headerContent.classList.add('collapsed');
                    header.classList.add('collapsed');
                    toggleBtn.textContent = 'â–¼';
                    toggleBtn.title = 'ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¡¨ç¤º';
                } else {
                    headerContent.classList.remove('collapsed');
                    header.classList.remove('collapsed');
                    toggleBtn.textContent = 'â–²';
                    toggleBtn.title = 'ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’éè¡¨ç¤º';
                }
            }

            // æ¤œç´¢ã‚¯ãƒªã‚¢
            clearSearch() {
                const searchBox = document.getElementById('searchBox');
                const clearBtn = document.getElementById('searchClearBtn');

                searchBox.value = '';
                clearBtn.style.display = 'none';

                // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãŒæœ‰åŠ¹ãªå ´åˆã¯ã€æ¤œç´¢ãƒ•ãƒ©ã‚°ã‚’ãã®ã¾ã¾ç¶­æŒ
                if (!this.isVersionFiltered) {
                    this.isSearching = false;
                }

                // æ¤œç´¢çµæœã‚’ã‚¯ãƒªã‚¢(ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãŒæœ‰åŠ¹ãªå ´åˆã¯å†è¨­å®š)
                if (this.isVersionFiltered) {
                    const versionIds = VERSION_DATA_KO[this.currentVersion] || [];
                    ['general', 'evolution', 'blessed'].forEach(category => {
                        this.searchResults[category] = ITEM_DATA_KO[category].filter(item => {
                            return versionIds.includes(item.id);
                        });
                    });
                } else {
                    this.searchResults = {
                        general: [],
                        evolution: [],
                        blessed: []
                    };
                }

                // ç¾åœ¨ã®ã‚¿ãƒ–ã‚’å†æç”»
                this.switchTab(this.currentTab);
            }

            // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ•ã‚£ãƒ«ã‚¿åˆ‡ã‚Šæ›¿ãˆ
            toggleVersionFilter(version) {
                const searchBox = document.getElementById('searchBox');

                // åŒã˜ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆã¯ãƒˆã‚°ãƒ«ã€é•ã†ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®å ´åˆã¯åˆ‡ã‚Šæ›¿ãˆ
                if (this.isVersionFiltered && this.currentVersion === version) {
                    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è§£é™¤
                    this.isVersionFiltered = false;
                    this.currentVersion = null;

                    // å…¨ã¦ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
                    document.querySelectorAll('.version-filter-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });

                    // æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã«å€¤ãŒã‚ã‚‹å ´åˆã¯æ¤œç´¢ã‚’å†å®Ÿè¡Œã€ãªã‘ã‚Œã°å®Œå…¨ã«ã‚¯ãƒªã‚¢
                    if (searchBox.value.trim()) {
                        this.performSearch(searchBox.value);
                    } else {
                        this.isSearching = false;
                        this.searchResults = {
                            general: [],
                            evolution: [],
                            blessed: []
                        };
                    }
                } else {
                    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æœ‰åŠ¹åŒ–ã¾ãŸã¯åˆ‡ã‚Šæ›¿ãˆ
                    this.isVersionFiltered = true;
                    this.currentVersion = version;

                    // å…¨ã¦ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
                    document.querySelectorAll('.version-filter-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });

                    // ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
                    const activeBtn = Array.from(document.querySelectorAll('.version-filter-btn'))
                        .find(btn => btn.textContent.includes(version));
                    if (activeBtn) {
                        activeBtn.classList.add('active');
                    }

                    // æ¤œç´¢ä¸­ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
                    this.isSearching = true;

                    // æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã«å€¤ãŒã‚ã‚‹å ´åˆã¯æ¤œç´¢ã‚’å†å®Ÿè¡Œ
                    if (searchBox.value.trim()) {
                        this.performSearch(searchBox.value);
                    } else {
                        // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«è©²å½“ã™ã‚‹ã‚¢ã‚¤ãƒ†ãƒ IDã‚’å–å¾—
                        const versionIds = VERSION_DATA_KO[version] || [];

                        // å„ã‚«ãƒ†ã‚´ãƒªã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
                        ['general', 'evolution', 'blessed'].forEach(category => {
                            this.searchResults[category] = ITEM_DATA_KO[category].filter(item => {
                                return versionIds.includes(item.id);
                            });
                        });
                    }
                }

                // ç¾åœ¨ã®ã‚¿ãƒ–ã‚’å†æç”»
                this.switchTab(this.currentTab);
            }

            // å…±æœ‰ãƒªãƒ³ã‚¯ã‚’ç”Ÿæˆã—ã¦ã‚³ãƒ”ãƒ¼
            shareItem() {
                if (!this.currentPopupItem) return;

                const itemId = this.currentPopupItem.id;
                const baseUrl = window.location.origin + window.location.pathname;
                const shareUrl = `${baseUrl}?item=${itemId}`;

                // ã‚³ãƒ”ãƒ¼å‡¦ç†
                const textArea = document.createElement('textarea');
                textArea.value = shareUrl;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();

                try {
                    document.execCommand('copy');
                    textArea.remove();

                    // ã‚³ãƒ”ãƒ¼æˆåŠŸã®è¡¨ç¤º
                    const shareBtn = document.getElementById('shareBtn');
                    const originalText = shareBtn.textContent;
                    shareBtn.textContent = 'âœ“';
                    shareBtn.classList.add('copied');

                    // 2ç§’å¾Œã«å…ƒã«æˆ»ã™
                    setTimeout(() => {
                        shareBtn.textContent = originalText;
                        shareBtn.classList.remove('copied');
                    }, 2000);
                } catch (err) {
                    console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ:', err);
                    textArea.remove();
                    alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }
            }

            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰å…±æœ‰ã‚¢ã‚¤ãƒ†ãƒ ã‚’é–‹ã
            openSharedItem() {
                const urlParams = new URLSearchParams(window.location.search);
                const itemId = urlParams.get('item');

                if (itemId) {
                    // å…¨ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ¤œç´¢
                    let foundItem = null;
                    let foundCategory = null;

                    for (let category of ['general', 'evolution', 'blessed']) {
                        const item = ITEM_DATA_KO[category].find(i => i.id === itemId);
                        if (item) {
                            foundItem = item;
                            foundCategory = category;
                            break;
                        }
                    }

                    if (foundItem && foundCategory) {
                        // ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‹ã
                        this.switchTab(foundCategory);
                        // å°‘ã—é…å»¶ã•ã›ã¦ã‹ã‚‰ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‹ã
                        setTimeout(() => {
                            this.showItemPopup(foundItem);
                        }, 100);
                    }
                }
            }

            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
            setupEventListeners() {
                // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
                document.getElementById('popupOverlay').onclick = (e) => {
                    if (e.target === document.getElementById('popupOverlay')) {
                        this.closePopup();
                    }
                };

                // ESCã‚­ãƒ¼ã§é–‰ã˜ã‚‹
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && document.getElementById('popupOverlay').classList.contains('show')) {
                        this.closePopup();
                    }
                });
            }
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ï¼ˆHTMLã‹ã‚‰å‘¼ã³å‡ºã™ãŸã‚ï¼‰
        let inventoryUI;

        function switchTab(tabName) {
            inventoryUI.switchTab(tabName);
        }

        function showEvolvedItemPopup(itemId) {
            inventoryUI.showEvolvedItemPopup(itemId);
        }

		function closePopup() {
            inventoryUI.closePopup();
        }

        function onSearchOptionChange() {
            inventoryUI.onSearchOptionChange();
        }

        function toggleHeader() {
            inventoryUI.toggleHeader();
        }

        function toggleVersionFilter(version) {
            inventoryUI.toggleVersionFilter(version);
        }

        function shareItem() {
            inventoryUI.shareItem();
        }

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function () {
            // UIã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
            inventoryUI = new InventoryUI();

            // åˆæœŸåŒ–
            inventoryUI.init();

            // å…±æœ‰ãƒªãƒ³ã‚¯ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯
            inventoryUI.openSharedItem();

            console.log('ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§UIãŒåˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ');
            console.log(`ä¸€èˆ¬å®ç‰©: ${ITEM_DATA_KO.general.length}å€‹`);
            console.log(`é€²åŒ–å®ç‰©: ${ITEM_DATA_KO.evolution.length}å€‹`);
        });

        // ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼å‡¦ç†
        function handleImageError(img) {
            img.style.display = 'none';
            console.warn('ç”»åƒãŒèª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸ:', img.src);
        }

        // è¨€èªåˆ‡ã‚Šæ›¿ãˆé–¢æ•°
        function switchLanguage(lang) {
            if (lang === 'ja') {
                window.location.href = 'index.html';
            } else if (lang === 'ko') {
                window.location.href = 'index_ko.html';
            }
        }
    </script>
</body>

</html>