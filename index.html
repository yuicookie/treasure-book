<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®ç‰©å›³é‘‘</title>
    <style>
        /*
        =================================
        åŸºæœ¬è¨­å®šã¨ãƒªã‚»ãƒƒãƒˆ
        =================================
        */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none; /* ç”»åƒä¿å­˜ç¦æ­¢ */
            /* -webkit-user-select: none; */ /* ã‚³ãƒ”ãƒ¼ç¦æ­¢ */
        }

        body {
            font-family: 'Arial', sans-serif;
            background-image: url('img/background.webp');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /*
        =================================
        ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ
        =================================
        */
        .book-frame {
            width: 100%;
            max-width: 800px;
            aspect-ratio: 4/3;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .inventory-container {
            background: #E8F5E8;
            border-radius: 20px;
            padding: 20px;
            width: 100%;
            height: 90vh;
            max-height: 90vh;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /*
        =================================
        ã‚¹ãƒãƒ›å¯¾å¿œãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–
        =================================
        */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                align-items: flex-start;
                padding-top: 20px;
            }

            .book-frame {
                width: 100%;
                aspect-ratio: unset;
                height: calc(100vh - 140px);
            }

            .inventory-container {
                height: 100%;
                max-height: 100%;
                padding: 15px;
                border-radius: 15px;
            }

            .header {
                padding-bottom: 10px;
            }

            .title {
                font-size: 20px;
            }

            .tab-buttons {
                gap: 5px;
            }

            .tab-btn {
                padding: 8px 12px;
                font-size: 14px;
            }

            .item-count {
                font-size: 12px;
            }

            /* ã‚¹ãƒãƒ›ç¸¦å‘ã: 7åˆ—è¡¨ç¤º */
            .inventory-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 8px;
                padding: 10px;
            }
        }

        /* ã‚¹ãƒãƒ›æ¨ªå‘ãå¯¾å¿œ */
        @media (max-width: 1768px) and (orientation: landscape) {
            body {
                align-items: center;
                padding: 10px 100px;
            }

            .book-frame {
                height: calc(100vh - 20px);
            }

            .inventory-container {
                padding: 10px;
            }

            .header {
                padding-bottom: 8px;
            }

            .title {
                font-size: 18px;
            }

            .tab-btn {
                padding: 6px 10px;
                font-size: 13px;
            }

            .item-count {
                font-size: 11px;
            }

            /* ã‚¹ãƒãƒ›æ¨ªå‘ã: 7åˆ—è¡¨ç¤ºï¼ˆå°‘ã—å°ã•ãï¼‰ */
            .inventory-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 6px;
                padding: 8px;
            }

    		.popup-overlay {
        		padding: 10px 60px;  /* å·¦å³ã«å¤§ããªä½™ç™½ã‚’è¿½åŠ  */
    		}

    		.popup {
        		padding: 10px;
        		max-width: none;           /* å¹…åˆ¶é™ã‚’è§£é™¤ */
        		width: 100%;               /* åˆ©ç”¨å¯èƒ½å¹…ã‚’100%ä½¿ç”¨ */
        		max-height: calc(100vh - 20px);  /* ç¸¦å¹…ã‚’ç”»é¢ã„ã£ã±ã„ã« */
        		height: calc(100vh - 20px);      /* å›ºå®šã®é«˜ã„ç¸¦å¹… */
    		}
        }

        /*
        =================================
        ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†
        =================================
        */
        .header {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
            flex-shrink: 0;
        }

        .title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center; /* ãƒœã‚¿ãƒ³ã‚’ä¸­å¤®æƒãˆã«ã™ã‚‹ */
        }

        /*
        =================================
        ã‚¿ãƒ–ãƒœã‚¿ãƒ³
        =================================
        */
        .tab-buttons {
            display: flex;
            gap: 10px;
            justify-content: center; /* ãƒœã‚¿ãƒ³ã‚’ä¸­å¤®æƒãˆã«ã™ã‚‹ */
        }

        .tab-btn {
            padding: 10px 10px;
            /* border: none; */
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 18px; /* æš«å®šå¯¾å¿œ */
        }

        .tab-btn.active {
            background: linear-gradient(45deg, #4fc3f7, #29b6f6);
            color: white;
        }

        .tab-btn:not(.active) {
            background: #f0f0f0;
            color: #666;
        }

        .tab-btn:hover:not(.active) {
            background: #e0e0e0;
        }

        /*
        =================================
        ç¥ç¦å®ç‰©ã®å›è»¢ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        =================================
        */
        .blessing-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 3;
            animation: blessing-rotate 3s linear infinite;
            pointer-events: none;
        }

        @keyframes blessing-rotate {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å†…ã®ç¥ç¦ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
        .popup-blessing-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 3;
            animation: blessing-rotate 3s linear infinite;
            pointer-events: none;
        }

        /* ç¥ç¦å®ç‰©ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .popup.blessed {
            background: linear-gradient(135deg, #e8f5e8, #4fc3f7);
            border: 3px solid #29b6f6;
        }

        /*
        =================================
        ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        =================================
        */
        .effect-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 6;
            pointer-events: none;
            animation: effect-loop 3s infinite;
        }

        @keyframes effect-loop {
            0% {
                background-image: url('img/treasure_frame_effect01.webp');
            }

            3.33% {
                background-image: url('img/treasure_frame_effect02.webp');
            }

            6.66% {
                background-image: url('img/treasure_frame_effect03.webp');
            }

            9.99% {
                background-image: url('img/treasure_frame_effect04.webp');
            }

            13.32% {
                background-image: url('img/treasure_frame_effect06.webp');
            }

            16.65% {
                background-image: none;
            }

            100% {
                background-image: none;
            }
        }

        /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å†…ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .popup-effect-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 6;
            pointer-events: none;
            animation: effect-loop 3s infinite;
        }

        /*
        =================================
        ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‚°ãƒªãƒƒãƒ‰
        =================================
        */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 8px;
            background: #FFF8DC;
            border-radius: 15px;
            position: relative;
            margin-top: 10px;
            min-height: 0;
        }

        .inventory-grid::-webkit-scrollbar {
            width: 8px;
        }

        .inventory-grid::-webkit-scrollbar-track {
            background: #e0e0e0;
            border-radius: 4px;
        }

        .inventory-grid::-webkit-scrollbar-thumb {
            background: #29b6f6;
            border-radius: 4px;
        }

        /*
        =================================
        ã‚¢ã‚¤ãƒ†ãƒ ã‚¹ãƒ­ãƒƒãƒˆ
        =================================
        */
        .item-slot {
            aspect-ratio: 1;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 15px;
        }

        .item-slot:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .item-frame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 1;
            pointer-events: none;
        }

        .item-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 2;
        }

        /*
        =================================
        ãƒ‘ãƒƒã‚·ãƒ–ã‚¿ã‚°ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        =================================
        */
        .passive-tag-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 5;
            pointer-events: none;
        }

        /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å†…ã®ãƒ‘ãƒƒã‚·ãƒ–ã‚¿ã‚°ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
        .popup-passive-tag-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 5;
            pointer-events: none;
        }

        /*
        =================================
        ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— - ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤
        =================================
        */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 20px;
        }

        .popup-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        /*
        =================================
        ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— - ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
        =================================
        */
        .popup {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            transform: scale(0.8);
            position: relative;
        }

        .popup-overlay.show .popup {
            transform: scale(1);
        }

        .popup-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        /*
        =================================
        ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— - ã‚¢ã‚¤ã‚³ãƒ³
        =================================
        */
        .popup-icon {
            width: 60px;
            height: 60px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
            flex-shrink: 0;
        }

        .popup-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 1;
        }

        .popup-icon .popup-item-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 2;
        }

        /*
        =================================
        ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— - ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚»ã‚¯ã‚·ãƒ§ãƒ³
        =================================
        */
        .popup-title {
            margin-right: 10px;
            font-size: 20px;
            font-weight: bold;
            line-height: 1.2;
            color: #333;
            white-space: pre-line;
            word-wrap: break-word;
        }

        .popup-section {
            margin-bottom: 15px;
            background: #f8f8f8;
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #e0e0e0;
        }

        .popup-section-title {
            background: #e8e8e8;
            margin: -15px -15px 10px -15px;
            padding: 10px 15px;
            border-radius: 10px 10px 0 0;
            border-bottom: 1px solid #d0d0d0;
            font-weight: bold;
            color: #666;
        }

        .popup-description {
            color: #555;
            line-height: 1.6;
            background: transparent;
            padding: 0;
            border-radius: 0;
        }

        /*
        =================================
        é€²åŒ–ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
        =================================
        */
        .evolution-preview {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding: 10px;
            background: #f0f8ff;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .evolution-preview:hover {
            background: #e3f2fd;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(41, 182, 246, 0.3);
        }

        .evolution-icon {
            width: 60px;
            height: 60px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
            border-radius: 8px;
            flex-shrink: 0;
        }

        .evolution-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 1;
        }

        .evolution-icon .evolution-item-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 2;
        }

        /*
        =================================
        é€²åŒ–å¾Œã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ«
        =================================
        */
        .popup.evolved {
            background: linear-gradient(135deg, #fff3e0, #ffcc02);
            border: 3px solid #ff9800;
        }

        /*
        =================================
        ä¸€èˆ¬å®ç‰©ã®ã‚¹ã‚¿ã‚¤ãƒ«
        =================================
        */
        .popup:not(.evolved) {
            border: 3px solid #ff9800;
        }

        /*
        =================================
        é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³
        =================================
        */
        .close-btn {
            position: absolute;
            top: 0px;
            right: 0px;
            background: url('img/btn_x.webp') no-repeat center center;  /* ç”»åƒã‚’èƒŒæ™¯ã«è¨­å®š */
            background-size: contain;  /* ç”»åƒã‚’ãƒœã‚¿ãƒ³ã‚µã‚¤ã‚ºã«åˆã‚ã›ã‚‹ */
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
        }

        .close-btn:hover {
            background-image: url('img/btn_x.webp');  /* ãƒ›ãƒãƒ¼æ™‚ã‚‚åŒã˜ç”»åƒ */
            background-color: rgba(0, 0, 0, 0.3);   /* è–„æš—ã„ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
            background-blend-mode: darken;           /* ç”»åƒã‚’æš—ãã™ã‚‹ãƒ–ãƒ¬ãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰ */
        }

        /*
        =================================
        ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— - ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
        =================================
        */
        @media (max-width: 768px) {
            .popup {
                padding: 20px;
                margin: 10px;
                /* max-width: calc(100vw - 20px); */
                max-height: calc(100vh - 120px);
            }

            .popup-header {
                gap: 10px;
                margin-bottom: 15px;
            }

            .popup-icon {
                width: 50px;
                height: 50px;
            }

            .popup-title {
                font-size: 18px;
            }

            .evolution-icon {
                width: 50px;
                height: 50px;
            }

            .close-btn {
                width: 25px;
                height: 25px;
                background: url('img/btn_x.webp') no-repeat center center;
                background-size: contain;
                font-size: 0;
                color: transparent;
            }

            .close-btn:hover {
                background-image: url('img/btn_x.webp');
                background-color: rgba(0, 0, 0, 0.3);
                background-blend-mode: darken;
            }
        }
        /*
        =================================
        ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¡¨ç¤º
        =================================
        */
        .update-version {
            position: absolute;
            bottom: 10px;
            left: 10px;
            font-size: 12px;
            color: #666;
            background: rgba(255, 255, 255, 0.8);
            padding: 4px 8px;
            border-radius: 4px;
            z-index: 10;
        }

        @media (max-width: 768px) {
            .update-version {
                font-size: 10px;
                bottom: 5px;
                left: 5px;
                padding: 2px 6px;
            }
        }
        /*
        =================================
        è¨€èªåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³
        =================================
        */
        .language-selector {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 14px;
        }

        .language-selector label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            color: #666;
        }

        .language-selector input[type="radio"] {
            margin: 0;
        }

        @media (max-width: 768px) {
            .language-selector {
                gap: 10px;
                font-size: 12px;
            }
        }
    </style>
</head>

<body>
    <div class="update-version">Ver:12.7<br>æ›´æ–°æ—¥ï¼š2025å¹´7æœˆ20æ—¥</div>
    <div class="book-frame">
        <div class="inventory-container">
<div class="header">
    <div class="title">
        ğŸ“– å®ç‰©å›³é‘‘
        <div class="language-selector">
            <label><input type="radio" name="language" value="ja" checked onchange="switchLanguage(this.value)"> æ—¥æœ¬èª</label>
            <label><input type="radio" name="language" value="ko" onchange="switchLanguage(this.value)"> í•œêµ­ì–´</label>
        </div>
    </div>
    <div class="tab-buttons">
        <button class="tab-btn active" id="generalTab" onclick="switchTab('general')">ä¸€èˆ¬å®ç‰©</button>
        <button class="tab-btn" id="evolutionTab" onclick="switchTab('evolution')">é€²åŒ–å®ç‰©</button>
        <button class="tab-btn" id="blessedTab" onclick="switchTab('blessed')">ç¥ç¦å®ç‰©</button>
    </div>
</div>

            <div class="inventory-grid" id="inventoryGrid">
                <!-- ã‚¢ã‚¤ãƒ†ãƒ ãŒJavaScriptã§å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
            </div>
        </div>
    </div>

    <div class="popup-overlay" id="popupOverlay">
        <div class="popup" id="popup">
            <button class="close-btn" onclick="closePopup()"></button>
            <div class="popup-header">
                <div class="popup-icon" id="popupIcon"></div>
                <div class="popup-title" id="popupTitle"></div>
            </div>
            <div class="popup-section">
                <div class="popup-section-title">è£…ç€åŠ¹æœ</div>
                <div class="popup-description" id="popupEffect"></div>
            </div>
            <div class="popup-section">
                <div class="popup-section-title">å…¥æ‰‹æ–¹æ³•</div>
                <div class="popup-description" id="popupMethod"></div>
            </div>
            <div class="popup-section" id="evolutionSection" style="display: none;">
                <div class="popup-section-title">é€²åŒ–å¯èƒ½ãªå®ç‰©</div>
                <div class="popup-description" id="popupEvolution"></div>
            </div>
        </div>
    </div>
    <script src="data.js"></script>
    <script>
        /*
        =================================
        ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆå‡¦ç†
        =================================
        */
        // ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã§322å€‹ã¾ã§æ‹¡å¼µ
        function generateExtendedData() {
            const rarities = ['C', 'C', 'C', 'B', 'B', 'A', 'S'];

            // ä¸€èˆ¬å®ç‰©ã‚’322å€‹ã¾ã§æ‹¡å¼µ
            for (let i = 11; i <= 322; i++) {
                const randomRarity = rarities[Math.floor(Math.random() * rarities.length)];
                const canEvolve = Math.random() > 0.7;

                ITEM_DATA.general.push({
                    id: `item_${i}`,
                    name: `ã‚¢ã‚¤ãƒ†ãƒ ${i}`,
                    rarity: randomRarity,
                    canEvolve: canEvolve,
                    effect: `æ§˜ã€…ãªåŠ¹æœã‚’æä¾›ã—ã¾ã™ï¼ˆã‚¢ã‚¤ãƒ†ãƒ ${i}ï¼‰`,
                    method: `ã‚²ãƒ¼ãƒ é€²è¡Œã‚’é€šã˜ã¦ç²å¾—ï¼ˆã‚¢ã‚¤ãƒ†ãƒ ${i}ï¼‰`,
                    description: `ã‚¢ã‚¤ãƒ†ãƒ ${i}ã®è©³ç´°ãªèª¬æ˜ã§ã™ã€‚`,
                    isDummy: true, // ãƒ€ãƒŸãƒ¼ãƒ•ãƒ©ã‚°ã‚’è¿½åŠ 
                    booknone: Math.random() > 0.7 // booknoneãƒ•ãƒ©ã‚°ã‚’è¿½åŠ 
                });

                // é€²åŒ–å¯èƒ½ãªã‚¢ã‚¤ãƒ†ãƒ ã¯é€²åŒ–ç‰ˆã‚‚ä½œæˆ
                if (canEvolve) {
                    const evolvedRarity = randomRarity === 'C' ? 'B' :
                        randomRarity === 'B' ? 'A' : 'S';

                    ITEM_DATA.evolution.push({
                        id: `item_${i}_evolved`,
                        name: `é€²åŒ–ã—ãŸ${ITEM_DATA.general[ITEM_DATA.general.length - 1].name}`,
                        rarity: evolvedRarity,
                        canEvolve: true,
                        effect: `å¼·åŒ–ã•ã‚ŒãŸåŠ¹æœã‚’æä¾›ã—ã¾ã™ï¼ˆé€²åŒ–ã‚¢ã‚¤ãƒ†ãƒ ${i}ï¼‰`,
                        method: `${ITEM_DATA.general[ITEM_DATA.general.length - 1].name}ã‚’é€²åŒ–ã•ã›ã¦ç²å¾—`,
                        baseId: `item_${i}`,
                        description: `é€²åŒ–ã—ãŸã‚¢ã‚¤ãƒ†ãƒ ${i}ã®è©³ç´°ãªèª¬æ˜ã§ã™ã€‚`,
                        isDummy: true, // ãƒ€ãƒŸãƒ¼ãƒ•ãƒ©ã‚°ã‚’è¿½åŠ 
                        booknone: Math.random() > 0.7 // booknoneãƒ•ãƒ©ã‚°ã‚’è¿½åŠ 
                    });

                    // ç¥ç¦å®ç‰©ã‚‚ä½œæˆ
                    const blessedRarity = evolvedRarity === 'B' ? 'A' :
                        evolvedRarity === 'A' ? 'S' : 'S';

                    ITEM_DATA.blessed.push({
                        id: `item_${i}_blessed`,
                        name: `ç¥ç¦ã•ã‚ŒãŸé€²åŒ–ã—ãŸ${ITEM_DATA.general[ITEM_DATA.general.length - 1].name}`,
                        rarity: blessedRarity,
                        canEvolve: false,
                        effect: `ç©¶æ¥µã®åŠ¹æœã‚’æä¾›ã—ã¾ã™ï¼ˆç¥ç¦ã‚¢ã‚¤ãƒ†ãƒ ${i}ï¼‰`,
                        method: `é€²åŒ–ã—ãŸ${ITEM_DATA.general[ITEM_DATA.general.length - 1].name}ã‚’ç¥ç¦ã—ã¦ç²å¾—`,
                        baseId: `item_${i}_evolved`,
                        description: `ç¥ç¦ã•ã‚ŒãŸã‚¢ã‚¤ãƒ†ãƒ ${i}ã®è©³ç´°ãªèª¬æ˜ã§ã™ã€‚`,
                        isDummy: true, // ãƒ€ãƒŸãƒ¼ãƒ•ãƒ©ã‚°ã‚’è¿½åŠ 
                        booknone: Math.random() > 0.7 // booknoneãƒ•ãƒ©ã‚°ã‚’è¿½åŠ 
                    });
                }
            }
        }

        // ãƒ‡ãƒ¼ã‚¿æ‹¡å¼µã‚’å®Ÿè¡Œ
        // generateExtendedData();

        /*
        =================================
        ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        =================================
        */
        // ã‚¢ã‚¤ãƒ†ãƒ ç”»åƒãƒ‘ã‚¹ç”Ÿæˆé–¢æ•°
        function getItemImagePath(itemId, isEvolved = false) {
            // ç¥ç¦å®ç‰©ã®å ´åˆã€é€²åŒ–å®ç‰©ã¨åŒã˜ç”»åƒã‚’ä½¿ç”¨
            if (itemId.includes('_blessed')) {
                const baseId = itemId.replace('_blessed', '');
                return `img/${baseId}.webp`;
            }
            return `img/${itemId}.webp`;
        }

        // ãƒ•ãƒ¬ãƒ¼ãƒ ç”»åƒãƒ‘ã‚¹ç”Ÿæˆé–¢æ•°
        function getFrameImagePath(rarity, tabType = 'general') {
            const rarityLower = rarity.toLowerCase();
            if (tabType === 'evolution') {
                return `img/treasure_mix_frame_${rarityLower}.webp`;
            } else if (tabType === 'blessed') {
                return `img/treasure_mix_frame_${rarityLower}.webp`;
            }
            return `img/treasure_frame_${rarityLower}.webp`;
        }

        // ç¥ç¦ã‚¨ãƒ•ã‚§ã‚¯ãƒˆç”»åƒãƒ‘ã‚¹ç”Ÿæˆé–¢æ•°
        function getBlessingEffectPath(rarity) {
            if (rarity === 'S') {
                return 'img/treasure_frame_effect05.webp';
            }
            return 'img/treasure_frame_effect07.webp';
        }
        // ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã«ã‚ˆã‚‹è‰²å–å¾—
        function getRarityColor(rarity) {
            switch (rarity) {
                case 'C': return '#808080';  // ç°è‰²
                case 'B': return '#4fc3f7';  // é’è‰²
                case 'A': return '#FF9800';  // ã‚ªãƒ¬ãƒ³ã‚¸è‰²
                case 'S': return '#9C27B0';  // ç´«è‰²
                default: return '#808080';
            }
        }

        /*
        =================================
        UIç®¡ç†ã‚¯ãƒ©ã‚¹
        =================================
        */
        // UIç®¡ç†ã‚¯ãƒ©ã‚¹
        class InventoryUI {
            constructor() {
                this.currentTab = 'general';
                this.currentPopupItem = null;
                this.popupHistory = []; // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®å±¥æ­´ã‚’ç®¡ç†
                this.popupSource = null; // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ç™ºç”Ÿæºã‚’è¨˜éŒ²
                this.scrollPositions = { // å„ã‚¿ãƒ–ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’ä¿æŒ
                    general: 0,
                    evolution: 0,
                    blessed: 0
                };
            }

            /*
            =================================
            ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‚°ãƒªãƒƒãƒ‰é–¢é€£ãƒ¡ã‚½ãƒƒãƒ‰
            =================================
            */
            // ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã«ã‚ˆã‚‹ã‚½ãƒ¼ãƒˆé †åºã‚’å®šç¾©
            getRaritySortOrder(rarity) {
                const order = { 'S': 1, 'A': 2, 'B': 3, 'C': 4 };
                return order[rarity] || 999;
            }

            // ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‚°ãƒªãƒƒãƒ‰ã‚’ä½œæˆ
            createInventoryGrid(items) {
                const grid = document.getElementById('inventoryGrid');
                grid.innerHTML = '';

                // ã‚¢ã‚¤ãƒ†ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’(ãƒ¬ã‚¢ãƒªãƒ†ã‚£â†’ãƒ€ãƒŸãƒ¼ãƒ•ãƒ©ã‚°â†’ãƒ‘ãƒƒã‚·ãƒ–ã‚¿ã‚°â†’booknoneâ†’ã‚¢ã‚¤ãƒ†ãƒ ãƒ‡ãƒ¼ã‚¿é…åˆ—é †)ã§ã‚½ãƒ¼ãƒˆ
                const sortedItems = [...items].sort((a, b) => {
                    // 1. ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã§ã‚½ãƒ¼ãƒˆï¼ˆSâ†’Aâ†’Bâ†’Cé †ï¼‰
                    const orderA = this.getRaritySortOrder(a.rarity);
                    const orderB = this.getRaritySortOrder(b.rarity);

                    if (orderA !== orderB) {
                        return orderA - orderB;
                    }

                    // 2. åŒã˜ãƒ¬ã‚¢ãƒªãƒ†ã‚£å†…ã§ã¯ãƒ€ãƒŸãƒ¼ãƒ•ãƒ©ã‚°ã§ã‚½ãƒ¼ãƒˆï¼ˆå®Ÿãƒ‡ãƒ¼ã‚¿ãŒå…ˆï¼‰
                    const isDummyA = a.isDummy || false;
                    const isDummyB = b.isDummy || false;

                    if (isDummyA !== isDummyB) {
                        return isDummyA - isDummyB; // false(0) ãŒå…ˆã€true(1) ãŒå¾Œ
                    }

                    // 3. åŒã˜ãƒ¬ã‚¢ãƒªãƒ†ã‚£ãƒ»ãƒ€ãƒŸãƒ¼ãƒ•ãƒ©ã‚°å†…ã§ã¯booknoneã§ã‚½ãƒ¼ãƒˆï¼ˆbooknoneãªã—ãŒå…ˆã€booknoneã‚ã‚ŠãŒå¾Œï¼‰
                    const hasBooknoneA = a.booknone || false;
                    const hasBooknoneB = b.booknone || false;

                    if (hasBooknoneA !== hasBooknoneB) {
                        return hasBooknoneA - hasBooknoneB; // false(0) ãŒå…ˆã€true(1) ãŒå¾Œ
                    }

                    // 4. åŒã˜ãƒ¬ã‚¢ãƒªãƒ†ã‚£ãƒ»ãƒ€ãƒŸãƒ¼ãƒ•ãƒ©ã‚°ãƒ»booknoneå†…ã§ã¯ãƒ‘ãƒƒã‚·ãƒ–ã‚¿ã‚°ã§ã‚½ãƒ¼ãƒˆï¼ˆãƒ‘ãƒƒã‚·ãƒ–ã‚¿ã‚°ãªã—ãŒå…ˆã€ãƒ‘ãƒƒã‚·ãƒ–ã‚¿ã‚°ã‚ã‚ŠãŒå¾Œï¼‰
                    const hasPassiveA = a.hasPassiveTag || false;
                    const hasPassiveB = b.hasPassiveTag || false;

                    if (hasPassiveA !== hasPassiveB) {
                        return hasPassiveA - hasPassiveB; // false(0) ãŒå…ˆã€true(1) ãŒå¾Œ
                    }

                    // 5. æœ€å¾Œã«ã‚¢ã‚¤ãƒ†ãƒ ãƒ‡ãƒ¼ã‚¿é…åˆ—é †ã§ã‚½ãƒ¼ãƒˆï¼ˆå…ƒã®é…åˆ—é †åºã‚’ç¶­æŒï¼‰
                    const indexA = items.indexOf(a);
                    const indexB = items.indexOf(b);

                    return indexA - indexB;
                });
                sortedItems.forEach(item => {
                    const slot = this.createItemSlot(item);
                    grid.appendChild(slot);
                });

                this.updateItemCount(sortedItems.length);
            }

            // ã‚¢ã‚¤ãƒ†ãƒ ã‚¹ãƒ­ãƒƒãƒˆã‚’ä½œæˆ
            createItemSlot(item) {
                const slot = document.createElement('div');
                slot.className = `item-slot ${item.rarity}`;
                slot.onclick = () => this.showItemPopup(item);

                // ãƒ•ãƒ¬ãƒ¼ãƒ ç”»åƒ
                const frameImage = document.createElement('div');
                frameImage.className = 'item-frame';
                frameImage.style.backgroundImage = `url('${getFrameImagePath(item.rarity, this.currentTab)}')`;

                // ã‚¢ã‚¤ãƒ†ãƒ ç”»åƒ
                const itemImage = document.createElement('div');
                itemImage.className = 'item-image';
                const isEvolved = this.currentTab === 'evolution' || this.currentTab === 'blessed';
                itemImage.style.backgroundImage = `url('${getItemImagePath(item.id, isEvolved)}')`;

                // ç¥ç¦å®ç‰©ã®å ´åˆã€z-indexã‚’è¨­å®šã—ã¦å›è»¢ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚ˆã‚Šä¸Šã«è¡¨ç¤º
                if (this.currentTab === 'blessed') {
                    itemImage.style.zIndex = '4';
                }

                slot.appendChild(frameImage);
                slot.appendChild(itemImage);

                // ç¥ç¦å®ç‰©ã®å ´åˆã€å›è»¢ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ 
                if (this.currentTab === 'blessed') {
                    const blessingEffect = document.createElement('div');
                    blessingEffect.className = 'blessing-effect';
                    blessingEffect.style.backgroundImage = `url('${getBlessingEffectPath(item.rarity)}')`;
                    slot.appendChild(blessingEffect);
                }

                // ãƒ‘ãƒƒã‚·ãƒ–ã‚¿ã‚°ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ï¼ˆä¸€ç•ªä¸Šã«è¡¨ç¤ºï¼‰
                if (item.hasPassiveTag) {
                    const passiveTagEffect = document.createElement('div');
                    passiveTagEffect.className = 'passive-tag-effect';
                    passiveTagEffect.style.backgroundImage = `url('img/treasure_tag_passive.webp')`;
                    slot.appendChild(passiveTagEffect);
                }

                // Sãƒ©ãƒ³ã‚¯ã®ç¥ç¦å®ç‰©ã®å ´åˆã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ï¼ˆæœ€ä¸Šä½ã«è¡¨ç¤ºï¼‰
                if (this.currentTab === 'blessed' && item.rarity === 'S') {
                    const effectAnimation = document.createElement('div');
                    effectAnimation.className = 'effect-animation';
                    slot.appendChild(effectAnimation);
                }

                return slot;
            }

            /*
            =================================
            ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—é–¢é€£ãƒ¡ã‚½ãƒƒãƒ‰
            =================================
            */
            // ã‚¢ã‚¤ãƒ†ãƒ è©³ç´°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤º
            showItemPopup(item, source = 'grid') {
                // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‹ãå‰ã«ç¾åœ¨ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’ä¿å­˜
                const grid = document.getElementById('inventoryGrid');
                if (grid && source === 'grid') {
                    this.scrollPositions[this.currentTab] = grid.scrollTop;
                }

                this.currentPopupItem = item;
                this.popupSource = source;

                // å±¥æ­´ã‚’ç®¡ç†ï¼ˆã‚°ãƒªãƒƒãƒ‰ã‹ã‚‰é–‹ã„ãŸå ´åˆã®ã¿å±¥æ­´ã«è¿½åŠ ï¼‰
                if (source === 'grid') {
                    this.popupHistory = [item];
                } else if (source === 'evolution' || source === 'blessed') {
                    this.popupHistory.push(item);
                }

                const overlay = document.getElementById('popupOverlay');
                const popup = document.getElementById('popup');
                const icon = document.getElementById('popupIcon');
                const title = document.getElementById('popupTitle');
                const effect = document.getElementById('popupEffect');
                const method = document.getElementById('popupMethod');
                const evolutionSection = document.getElementById('evolutionSection');
                const evolution = document.getElementById('popupEvolution');

                // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ä¸€ç•ªä¸Šã«æˆ»ã™
                popup.scrollTop = 0;

                // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
                popup.classList.remove('evolved', 'blessed');
                icon.classList.remove('evolved');

                // é€²åŒ–å¾Œã‚¢ã‚¤ãƒ†ãƒ ã®å ´åˆã€é»„è‰²èƒŒæ™¯ã‚’é©ç”¨
                const isEvolved = this.currentTab === 'evolution';
                const isBlessed = this.currentTab === 'blessed';
                if (isEvolved) {
                    popup.classList.add('evolved');
                    icon.classList.add('evolved');
                } else if (isBlessed) {
                    popup.classList.add('blessed');
                    icon.classList.add('evolved');
                }

                // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚¢ã‚¤ã‚³ãƒ³è¨­å®šï¼ˆãƒ•ãƒ¬ãƒ¼ãƒ ä»˜ãï¼‰
                const frameImageUrl = getFrameImagePath(item.rarity, this.currentTab);
                const itemImageUrl = getItemImagePath(item.id, isEvolved || isBlessed);

                icon.style.backgroundImage = `url('${frameImageUrl}')`;

                let iconHTML = `<div class="popup-item-image" style="background-image: url('${itemImageUrl}'); z-index: 4;"></div>`;

                // ç¥ç¦å®ç‰©ã®å ´åˆã€å›è»¢ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ 
                if (isBlessed) {
                    const blessingEffectUrl = getBlessingEffectPath(item.rarity);
                    iconHTML += `<div class="popup-blessing-effect" style="background-image: url('${blessingEffectUrl}'); z-index: 3;"></div>`;
                }

                // ãƒ‘ãƒƒã‚·ãƒ–ã‚¿ã‚°ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ï¼ˆä¸€ç•ªä¸Šã«è¡¨ç¤ºï¼‰
                if (item.hasPassiveTag) {
                    iconHTML += `<div class="popup-passive-tag-effect" style="background-image: url('img/treasure_tag_passive.webp'); z-index: 5;"></div>`;
                }

                // Sãƒ©ãƒ³ã‚¯ã®ç¥ç¦å®ç‰©ã®å ´åˆã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ï¼ˆæœ€ä¸Šä½ã«è¡¨ç¤ºï¼‰
                if (isBlessed && item.rarity === 'S') {
                    iconHTML += `<div class="popup-effect-animation" style="z-index: 6;"></div>`;
                }

                icon.innerHTML = iconHTML;

                // ã‚¢ã‚¤ãƒ†ãƒ åã«è‰²ã‚’é©ç”¨
                title.textContent = item.name;
                title.style.color = getRarityColor(item.rarity);

                effect.textContent = item.effect.replace(/\\n/g, '\n'); //'/n'ã§æ”¹è¡Œã™ã‚‹
                effect.style.whiteSpace = 'pre-line';

                method.textContent = item.method;

                // é€²åŒ–å¯èƒ½ãªã‚¢ã‚¤ãƒ†ãƒ ã®å ´åˆ
                if (item.canEvolve) {
                    evolutionSection.style.display = 'block';

                    let nextEvolutionItem = null;
                    if (this.currentTab === 'general') {
                        nextEvolutionItem = this.findEvolvedItem(item.id);
                        evolutionSection.querySelector('.popup-section-title').textContent = 'é€²åŒ–å¯èƒ½ãªå®ç‰©';
                    } else if (this.currentTab === 'evolution') {
                        nextEvolutionItem = this.findBlessedItem(item.id);
                        evolutionSection.querySelector('.popup-section-title').textContent = 'ç¥ç¦ã•ã‚ŒãŸå®ç‰©';
                    }

                    if (nextEvolutionItem) {
                        evolution.innerHTML = this.createEvolutionPreview(nextEvolutionItem);
                    }
                } else {
                    evolutionSection.style.display = 'none';
                }

                // ã‚¢ã‚¤ãƒ†ãƒ èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
                this.addDescriptionSection(item);

                overlay.classList.add('show');
            }
            // ã‚¢ã‚¤ãƒ†ãƒ èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
            addDescriptionSection(item) {
                // æ—¢å­˜ã®èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤
                const existingDescSection = document.getElementById('descriptionSection');
                if (existingDescSection) {
                    existingDescSection.remove();
                }

                const popup = document.getElementById('popup');
                const evolutionSection = document.getElementById('evolutionSection');

                // èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
                const descSection = document.createElement('div');
                descSection.id = 'descriptionSection';
                descSection.className = 'popup-section';
                const description = item.description || 'ã‚¢ã‚¤ãƒ†ãƒ ã®èª¬æ˜ãŒã‚ã‚Šã¾ã›ã‚“ã€‚';
                const formattedDescription = description.replace(/\\n/g, '\n');
                descSection.innerHTML = `
                <div class="popup-section-title">èª¬æ˜</div>
                <div class="popup-description" style="white-space: pre-line;">${formattedDescription}</div>
                `;

                // é€²åŒ–å¯èƒ½ã‚¢ã‚¤ãƒ†ãƒ ã®å ´åˆã¯é€²åŒ–ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å¾Œã«ã€ãã†ã§ãªã‘ã‚Œã°å…¥æ‰‹æ–¹æ³•ã®å¾Œã«è¿½åŠ 
                if (item.canEvolve && (this.currentTab === 'general' || this.currentTab === 'evolution')) {
                    evolutionSection.insertAdjacentElement('afterend', descSection);
                } else {
                    const methodSection = popup.querySelector('.popup-section:nth-child(4)'); // å…¥æ‰‹æ–¹æ³•ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³
                    if (methodSection) {
                        methodSection.insertAdjacentElement('afterend', descSection);
                    }
                }
            }
            // é€²åŒ–ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼HTMLä½œæˆ
            createEvolutionPreview(evolvedItem) {
                // ç¥ç¦å®ç‰©ã‹ã©ã†ã‹ã‚’åˆ¤å®š
                const isBlessed = ITEM_DATA.blessed.some(item => item.id === evolvedItem.id);
                const tabType = isBlessed ? 'blessed' : 'evolution';

                let iconHTML = `<div class="evolution-item-image" style="background-image: url('${getItemImagePath(evolvedItem.id, true)}'); z-index: 4;"></div>`;

                // ç¥ç¦å®ç‰©ã®å ´åˆã®ã¿ã€å›è»¢ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ 
                if (isBlessed) {
                    const blessingEffectUrl = getBlessingEffectPath(evolvedItem.rarity);
                    iconHTML += `<div class="blessing-effect" style="background-image: url('${blessingEffectUrl}'); z-index: 3;"></div>`;
                }

                // ãƒ‘ãƒƒã‚·ãƒ–ã‚¿ã‚°ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ï¼ˆä¸€ç•ªä¸Šã«è¡¨ç¤ºï¼‰
                if (evolvedItem.hasPassiveTag) {
                    iconHTML += `<div class="passive-tag-effect" style="background-image: url('img/treasure_tag_passive.webp'); z-index: 5;"></div>`;
                }

                // Sãƒ©ãƒ³ã‚¯ã®ç¥ç¦å®ç‰©ã®å ´åˆã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ï¼ˆæœ€ä¸Šä½ã«è¡¨ç¤ºï¼‰
                if (isBlessed && evolvedItem.rarity === 'S') {
                    iconHTML += `<div class="effect-animation" style="z-index: 6;"></div>`;
                }

                return `
        <div class="evolution-preview" onclick="inventoryUI.showEvolvedItemPopup('${evolvedItem.id}')">
            <div class="evolution-icon" style="background-image: url('${getFrameImagePath(evolvedItem.rarity, tabType)}');">
                ${iconHTML}
            </div>
            <div>
                <div style="font-weight: bold; color: ${getRarityColor(evolvedItem.rarity)};">${evolvedItem.name}</div>
                <div style="font-size: 14px; color: #666; margin-top: 5px;">${evolvedItem.effect}</div>
            </div>
        </div>
    `;
            }
            // é€²åŒ–ã—ãŸã‚¢ã‚¤ãƒ†ãƒ ã‚’æ¤œç´¢
            findEvolvedItem(baseId) {
                return ITEM_DATA.evolution.find(item => item.baseId === baseId);
            }

            // ç¥ç¦ã•ã‚ŒãŸã‚¢ã‚¤ãƒ†ãƒ ã‚’æ¤œç´¢
            findBlessedItem(baseId) {
                return ITEM_DATA.blessed.find(item => item.baseId === baseId);
            }
            // é€²åŒ–ã—ãŸã‚¢ã‚¤ãƒ†ãƒ ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
            showEvolvedItemPopup(itemId) {
                // é€²åŒ–ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ¤œç´¢
                let evolvedItem = ITEM_DATA.evolution.find(item => item.id === itemId);
                if (evolvedItem) {
                    // ä¸€èˆ¬å®ç‰©ã‚¿ãƒ–ã‹ã‚‰é€²åŒ–å®ç‰©ã‚’é–‹ãå ´åˆã€ã‚¿ãƒ–ã‚’ä¸€æ™‚çš„ã«åˆ‡ã‚Šæ›¿ãˆ
                    const originalTab = this.currentTab;
                    this.currentTab = 'evolution';
                    this.showItemPopup(evolvedItem, 'evolution');
                    // ã‚¿ãƒ–ã‚’å…ƒã«æˆ»ã™å¿…è¦ã¯ãªã„ï¼ˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒé–‹ã„ã¦ã„ã‚‹é–“ã¯ã‚¿ãƒ–çŠ¶æ…‹ã‚’ç¶­æŒï¼‰
                    return;
                }

                // ç¥ç¦ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ¤œç´¢
                let blessedItem = ITEM_DATA.blessed.find(item => item.id === itemId);
                if (blessedItem) {
                    // é€²åŒ–å®ç‰©ã‚¿ãƒ–ã‹ã‚‰ç¥ç¦å®ç‰©ã‚’é–‹ãå ´åˆã€ã‚¿ãƒ–ã‚’ä¸€æ™‚çš„ã«åˆ‡ã‚Šæ›¿ãˆ
                    const originalTab = this.currentTab;
                    this.currentTab = 'blessed';
                    this.showItemPopup(blessedItem, 'blessed');
                    return;
                }
            }
            // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
            closePopup() {
                const overlay = document.getElementById('popupOverlay');
                const popup = document.getElementById('popup');
                const icon = document.getElementById('popupIcon');

                // å±¥æ­´ãŒ2ã¤ä»¥ä¸Šã‚ã‚‹å ´åˆï¼ˆé€šå¸¸å®ç‰©â†’é€²åŒ–å®ç‰©ã®é †ã§é–‹ã„ãŸå ´åˆï¼‰
                if (this.popupHistory.length >= 2) {
                    // æœ€å¾Œã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤
                    this.popupHistory.pop();

                    // å…ƒã®ã‚¢ã‚¤ãƒ†ãƒ ï¼ˆé€šå¸¸å®ç‰©ï¼‰ã‚’è¡¨ç¤º
                    const previousItem = this.popupHistory[this.popupHistory.length - 1];

                    // å…ƒã®ã‚¿ãƒ–ã«æˆ»ã™
                    if (this.popupHistory.length === 1) {
                        // æœ€åˆã®ã‚¢ã‚¤ãƒ†ãƒ ã®å ´åˆã€ãã®ã‚¢ã‚¤ãƒ†ãƒ ãŒå±ã™ã‚‹ã‚¿ãƒ–ã«æˆ»ã™
                        if (ITEM_DATA.general.some(item => item.id === previousItem.id)) {
                            this.currentTab = 'general';
                        } else if (ITEM_DATA.evolution.some(item => item.id === previousItem.id)) {
                            this.currentTab = 'evolution';
                        } else if (ITEM_DATA.blessed.some(item => item.id === previousItem.id)) {
                            this.currentTab = 'blessed';
                        }
                    } else {
                        // 2ã¤ä»¥ä¸Šã‚ã‚‹å ´åˆã¯ã€å‰ã®ã‚¢ã‚¤ãƒ†ãƒ ãŒæ‰€å±ã™ã‚‹ã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆã‚‹
                        if (ITEM_DATA.general.some(item => item.id === previousItem.id)) {
                            this.currentTab = 'general';
                        } else if (ITEM_DATA.evolution.some(item => item.id === previousItem.id)) {
                            this.currentTab = 'evolution';
                        } else if (ITEM_DATA.blessed.some(item => item.id === previousItem.id)) {
                            this.currentTab = 'blessed';
                        }
                    }

                    this.showItemPopup(previousItem, 'history');
                    return;
                }

                // é€šå¸¸ã®é–‰ã˜ã‚‹å‡¦ç†
                overlay.classList.remove('show');
                popup.classList.remove('evolved', 'blessed');
                icon.classList.remove('evolved');

                // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®å…¨ã¦ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å®Œå…¨ã«ã‚¯ãƒªã‚¢
                icon.innerHTML = '';
                icon.style.backgroundImage = '';
                document.getElementById('popupTitle').textContent = '';
                document.getElementById('popupTitle').style.color = '';
                document.getElementById('popupEffect').textContent = '';
                document.getElementById('popupEffect').style.whiteSpace = '';
                document.getElementById('popupMethod').textContent = '';
                document.getElementById('popupEvolution').innerHTML = '';
                document.getElementById('evolutionSection').style.display = 'none';

                // å‹•çš„ã«è¿½åŠ ã•ã‚ŒãŸèª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤
                const existingDescSection = document.getElementById('descriptionSection');
                if (existingDescSection) {
                    existingDescSection.remove();
                }

                // çŠ¶æ…‹ã‚’å®Œå…¨ã«ãƒªã‚»ãƒƒãƒˆ
                this.currentPopupItem = null;
                this.popupHistory = [];
                this.popupSource = null;
            }

            // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
            switchTab(tabName) {
                const grid = document.getElementById('inventoryGrid');

                // ç¾åœ¨ã®ã‚¿ãƒ–ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’ä¿å­˜
                if (this.currentTab && grid) {
                    this.scrollPositions[this.currentTab] = grid.scrollTop;
                }

                this.currentTab = tabName;

                // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
                document.getElementById('generalTab').classList.toggle('active', tabName === 'general');
                document.getElementById('evolutionTab').classList.toggle('active', tabName === 'evolution');
                document.getElementById('blessedTab').classList.toggle('active', tabName === 'blessed');

                // ã‚¢ã‚¤ãƒ†ãƒ ãƒªã‚¹ãƒˆæ›´æ–°
                const items = ITEM_DATA[tabName];
                this.createInventoryGrid(items);

                // ä¿å­˜ã•ã‚ŒãŸã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’å¾©å…ƒ
                if (grid && this.scrollPositions[tabName] !== undefined) {
                    // å°‘ã—é…å»¶ã‚’ã‹ã‘ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’å¾©å…ƒï¼ˆDOMæ›´æ–°å¾Œã«å®Ÿè¡Œï¼‰
                    setTimeout(() => {
                        grid.scrollTop = this.scrollPositions[tabName];
                    }, 10);
                }
            }
            // ã‚¢ã‚¤ãƒ†ãƒ æ•°æ›´æ–°
            updateItemCount(count) {
                const currentCountElement = document.getElementById('currentCount');
                if (currentCountElement) {
                    currentCountElement.textContent = count;
                }
            }

            // åˆæœŸåŒ–
            init() {
                this.switchTab('general');
                this.setupEventListeners();
                this.addCustomStyles();
            }

            // ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ 
            addCustomStyles() {
                const style = document.createElement('style');
                document.head.appendChild(style);
            }

            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
            setupEventListeners() {
                // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
                document.getElementById('popupOverlay').onclick = (e) => {
                    if (e.target === document.getElementById('popupOverlay')) {
                        this.closePopup();
                    }
                };

                // ESCã‚­ãƒ¼ã§é–‰ã˜ã‚‹
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && document.getElementById('popupOverlay').classList.contains('show')) {
                        this.closePopup();
                    }
                });
            }
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ï¼ˆHTMLã‹ã‚‰å‘¼ã³å‡ºã™ãŸã‚ï¼‰
        let inventoryUI;

        function switchTab(tabName) {
            inventoryUI.switchTab(tabName);
        }

        function showEvolvedItemPopup(itemId) {
            inventoryUI.showEvolvedItemPopup(itemId);
        }

        function closePopup() {
            inventoryUI.closePopup();
        }

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function () {
            // UIã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
            inventoryUI = new InventoryUI();

            // åˆæœŸåŒ–
            inventoryUI.init();

            console.log('ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§UIãŒåˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ');
            console.log(`ä¸€èˆ¬å®ç‰©: ${ITEM_DATA.general.length}å€‹`);
            console.log(`é€²åŒ–å®ç‰©: ${ITEM_DATA.evolution.length}å€‹`);
        });

        // ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼å‡¦ç†
        function handleImageError(img) {
            img.style.display = 'none';
            console.warn('ç”»åƒãŒèª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸ:', img.src);
        }

        // è¨€èªåˆ‡ã‚Šæ›¿ãˆé–¢æ•°
        function switchLanguage(lang) {
            if (lang === 'ja') {
                window.location.href = 'index.html';
            } else if (lang === 'ko') {
                window.location.href = 'index_ko.html';
            }
        }
    </script>
</body>

</html>